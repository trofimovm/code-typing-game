<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–ï–ö–ò LOW-–ö–û–î–ò–ù–ì | MWS Code Challenge üèóÔ∏è</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <style>
        /* MTS Fonts */
        @font-face {
            font-family: 'MTS Compact';
            src: url('fonts/MTSCompact-Regular.woff2') format('woff2');
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: 'MTS Compact';
            src: url('fonts/MTSCompact-Medium.woff2') format('woff2');
            font-weight: 500;
            font-style: normal;
        }

        @font-face {
            font-family: 'MTS Text';
            src: url('fonts/MTSText-Regular.woff2') format('woff2');
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: 'MTS Wide';
            src: url('fonts/MTSWide-Medium.woff2') format('woff2');
            font-weight: 500;
            font-style: normal;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'MTS Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: white;
            color: #333;
            overflow-x: hidden;
            overflow-y: auto;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            min-height: 100vh;
            margin: 0;
        }

        .video-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
        }

        .video-background video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(200, 200, 200, 0.3);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .logo svg {
            height: 30px;
            width: auto;
        }

        .stats {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            font-family: 'MTS Compact', sans-serif;
            font-weight: 500;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 28px;
            font-family: 'MTS Compact', sans-serif;
            font-weight: 500;
            color: #999;
            font-variant-numeric: tabular-nums;
            min-width: 70px;
            display: inline-block;
            text-align: center;
        }

        .drink-icon {
            font-size: 32px;
            transition: all 0.3s ease;
        }

        .drink-icon-locked {
            filter: grayscale(100%);
            opacity: 0.3;
        }

        .drink-icon-unlocked {
            filter: none;
            opacity: 1;
            animation: drinkPulse 1s ease-in-out;
        }

        @keyframes drinkPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 30px 20px 30px;
            height: calc(100vh - 90px);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        .game-title {
            text-align: center;
            margin-bottom: 15px;
            margin-top: 30px;
        }

        .game-title h1 {
            font-size: 36px;
            font-family: 'MTS Wide', sans-serif;
            font-weight: 500;
            color: #333;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .game-title p {
            font-size: 16px;
            color: #666;
        }

        .code-display {
            background: #f8f8f8;
            border: 3px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .code-label {
            font-size: 14px;
            font-family: 'MTS Compact', sans-serif;
            font-weight: 500;
            color: #666;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .code-target {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 20px;
            line-height: 1.6;
            color: #333;
            white-space: pre;
            padding: 20px;
            background: white;
            border-radius: 5px;
            border: 2px solid #eee;
        }

        .editor-container {
            border: 3px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 15px;
        }

        #editor {
            height: 250px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .btn {
            padding: 14px 24px;
            font-size: 16px;
            font-weight: 500;
            font-family: 'MTS Compact', sans-serif;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            text-transform: none;
            letter-spacing: 0;
        }

        .btn-primary {
            background: white;
            color: #333;
            border: 2px solid #333;
        }

        .btn-primary:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background: #f8f8f8;
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: white;
            color: #666;
            border: 2px solid #ddd;
        }

        .btn-secondary:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            background: #fafafa;
        }

        .btn-secondary:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .language-dropdown {
            padding: 14px 16px;
            font-size: 15px;
            font-family: 'MTS Compact', sans-serif;
            font-weight: 500;
            background: white;
            color: #333;
            border: 2px solid #888;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            outline: none;
            min-width: 180px;
        }

        .language-dropdown:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(255, 0, 50, 0.15);
        }

        .language-dropdown:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 3px rgba(255, 0, 50, 0.2);
        }

        .language-dropdown:active {
            transform: scale(0.98);
        }

        .progress-bar {
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #666, #888);
            transition: width 0.3s;
        }

        .instructions {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 2px solid rgba(200, 200, 200, 0.4);
            color: #333;
            padding: 50px 30px 30px 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .instructions h2 {
            font-size: 32px;
            font-family: 'MTS Wide', sans-serif;
            font-weight: 500;
            margin-top: 0;
            margin-bottom: 15px;
            color: #333;
        }

        .instructions p {
            font-size: 16px;
            line-height: 1.6;
            color: #333;
        }

        .final-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .final-screen.show {
            display: flex;
        }

        .final-screen-content {
            background: white;
            border: 3px solid #888;
            border-radius: 15px;
            padding: 50px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .final-screen h2 {
            font-size: 42px;
            font-family: 'MTS Wide', sans-serif;
            font-weight: 500;
            color: #333;
            margin-bottom: 30px;
        }

        .final-stats {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 40px;
        }

        .final-stat-card {
            background: #f5f5f5;
            padding: 20px 30px;
            border-radius: 10px;
            min-width: 150px;
        }

        .final-stat-label {
            font-size: 14px;
            font-family: 'MTS Compact', sans-serif;
            font-weight: 500;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .final-stat-value {
            font-size: 36px;
            font-family: 'MTS Compact', sans-serif;
            font-weight: 500;
            color: #aaa;
        }

        .drink-status {
            margin: 40px 0;
        }

        .drink-result {
            padding: 30px;
            border-radius: 10px;
        }

        #drinkUnlocked {
            background: linear-gradient(135deg, #00cc66 0%, #00994d 100%);
        }

        #drinkLocked {
            background: #f5f5f5;
        }

        .drink-icon-large {
            font-size: 80px;
            margin-bottom: 15px;
            animation: drinkPulse 1.5s ease-in-out;
        }

        .drink-icon-large-gray {
            font-size: 80px;
            margin-bottom: 15px;
            filter: grayscale(100%);
            opacity: 0.3;
        }

        .drink-message {
            font-size: 28px;
            font-family: 'MTS Wide', sans-serif;
            font-weight: 500;
            color: white;
            margin-bottom: 10px;
        }

        #drinkLocked .drink-message {
            color: #333;
        }

        .drink-reason {
            font-size: 16px;
            color: #666;
            font-style: italic;
        }

        .final-message {
            font-size: 18px;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .finish-btn {
            background: white;
            color: #666;
            border: 2px solid #ddd;
            padding: 10px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            font-family: 'MTS Compact', sans-serif;
            cursor: pointer;
            transition: transform 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            margin-left: 20px;
        }

        .finish-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(255, 0, 50, 0.2);
        }

        .finish-btn:active {
            transform: scale(0.98);
        }

        .feedback {
            text-align: center;
            margin-top: 15px;
            font-size: 18px;
            font-weight: bold;
            min-height: 30px;
        }

        .feedback.perfect {
            color: #00cc66;
        }

        .feedback.good {
            color: #ff9900;
        }

        .feedback.error {
            color: #cc0000;
        }

        .pulse {
            animation: pulse 0.5s;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .shake {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Cloud Architect game styles */
        .service-block {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 8px;
            cursor: move;
            transition: all 0.3s;
            font-size: 12px;
            font-family: 'MTS Compact', sans-serif;
            font-weight: 500;
            color: #333;
            text-align: center;
        }

        .service-block:hover {
            background: #f8f8f8;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .service-block.dragging {
            opacity: 0.5;
        }

        .dropped-block {
            position: absolute;
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px 20px;
            cursor: move;
            transition: all 0.3s;
            font-size: 14px;
            font-family: 'MTS Compact', sans-serif;
            font-weight: 500;
            color: #333;
            text-align: center;
            min-width: 120px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        .dropped-block:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        .dropped-block:hover .connection-handle {
            opacity: 1;
        }

        .dropped-block.selected {
            border-color: #00cc66;
            background: #f0fff7;
        }

        .dropped-block.connecting {
            border-color: #ff9900;
            background: #fff9f0;
        }

        .connection-handle {
            position: absolute;
            width: 16px;
            height: 16px;
            background: #ccc;
            border: 2px solid white;
            border-radius: 50%;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            pointer-events: all;
            z-index: 100;
        }

        .connection-handle:hover {
            transform: scale(1.3);
            background: #00cc66;
            opacity: 1 !important;
        }

        .connection-handle.handle-right {
            right: -8px;
            top: 50%;
            transform: translateY(-50%);
        }

        .connection-handle.handle-right:hover {
            transform: translateY(-50%) scale(1.3);
        }

        .connection-handle.handle-left {
            left: -8px;
            top: 50%;
            transform: translateY(-50%);
        }

        .connection-handle.handle-left:hover {
            transform: translateY(-50%) scale(1.3);
        }

        .connection-handle.handle-top {
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
        }

        .connection-handle.handle-top:hover {
            transform: translateX(-50%) scale(1.3);
        }

        .connection-handle.handle-bottom {
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
        }

        .connection-handle.handle-bottom:hover {
            transform: translateX(-50%) scale(1.3);
        }

        .connection-line {
            stroke: #ddd;
            stroke-width: 3;
            fill: none;
            marker-end: url(#arrowhead);
            cursor: pointer;
            transition: stroke-width 0.2s;
        }

        .connection-line:hover {
            stroke-width: 5;
        }

        .connection-line.valid {
            stroke: #00cc66;
        }

        .connection-line.invalid {
            stroke: #cc0000;
            stroke-dasharray: 5, 5;
        }

        .delete-connection-btn {
            position: absolute;
            background: #cc0000;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
            pointer-events: all;
            z-index: 100;
        }

        .delete-connection-btn:hover {
            background: #cc0028;
            transform: scale(1.2);
        }

        .delete-block-btn {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #cc0000;
            color: white;
            border: 2px solid white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
            pointer-events: all;
            z-index: 101;
            line-height: 1;
        }

        .dropped-block:hover .delete-block-btn {
            display: flex;
        }

        .delete-block-btn:hover {
            background: #cc0028;
            transform: scale(1.2);
        }

        /* ========================================
           MOBILE ADAPTATION STYLES
           ======================================== */

        /* Tablet (portrait) and smaller */
        @media screen and (max-width: 1024px) {
            .header {
                padding: 10px 15px;
                flex-wrap: wrap;
            }

            .stats {
                gap: 15px;
            }

            .stat-item {
                font-size: 14px;
            }

            .main-container {
                padding: 15px;
            }

            .game-container {
                max-width: 100%;
                padding: 20px;
            }
        }

        /* Mobile phones */
        @media screen and (max-width: 768px) {
            body {
                font-size: 14px;
            }

            .header {
                padding: 8px 10px;
            }

            .logo svg {
                height: 24px;
            }

            .stats {
                gap: 10px;
                font-size: 12px;
            }

            .stat-label {
                font-size: 10px;
            }

            .stat-value {
                font-size: 16px;
            }

            .main-container {
                padding: 10px;
            }

            .game-container, .start-screen {
                padding: 15px;
                max-width: 100%;
            }

            h1 {
                font-size: 24px !important;
            }

            h2 {
                font-size: 20px !important;
            }

            /* Buttons - touch friendly */
            .btn, button {
                min-height: 44px;
                font-size: 16px !important;
                padding: 12px 20px !important;
                margin: 5px 0;
            }

            .controls {
                flex-direction: column;
                gap: 10px;
            }

            .controls .btn {
                width: 100%;
            }

            /* Language selector */
            select {
                min-height: 44px;
                font-size: 16px !important;
                padding: 10px !important;
                width: 100%;
            }

            /* Code editor */
            #editor, #bonusEditor {
                min-height: 250px !important;
                font-size: 12px;
            }

            .editor-container {
                height: 250px !important;
            }

            /* Feedback */
            #feedback {
                font-size: 16px !important;
                padding: 12px !important;
            }

            #bugDescription {
                font-size: 14px !important;
                padding: 12px !important;
            }

            /* Target code display */
            #targetCode {
                font-size: 12px !important;
                padding: 12px !important;
            }

            /* Final screen */
            .final-screen-content {
                padding: 20px !important;
                max-width: 95%;
            }

            .final-stat-card {
                padding: 15px !important;
            }

            .final-stat-value {
                font-size: 32px !important;
            }

            .final-stat-label {
                font-size: 12px !important;
            }

            /* Architect game specific */
            .blocks-container {
                flex-wrap: wrap;
            }

            .block {
                min-width: 100px;
                font-size: 12px !important;
                padding: 10px !important;
            }

            .canvas-container {
                min-height: 300px !important;
            }

            /* Hide less important elements on mobile */
            .video-background {
                display: none;
            }
        }

        /* Small phones */
        @media screen and (max-width: 480px) {
            .header {
                padding: 5px 8px;
            }

            .stat-item {
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            h1 {
                font-size: 20px !important;
            }

            h2 {
                font-size: 18px !important;
            }

            .btn {
                font-size: 14px !important;
                padding: 10px 15px !important;
            }

            #editor, #bonusEditor {
                min-height: 200px !important;
                font-size: 11px;
            }

            .editor-container {
                height: 200px !important;
            }

            .final-screen-content {
                padding: 15px !important;
            }

            .final-stat-value {
                font-size: 28px !important;
            }

            .block {
                min-width: 80px;
                font-size: 11px !important;
            }
        }

        /* Landscape orientation on mobile */
        @media screen and (max-width: 896px) and (orientation: landscape) {
            .header {
                padding: 5px 10px;
            }

            .stats {
                font-size: 11px;
            }

            .main-container {
                padding: 5px;
            }

            .game-container {
                padding: 10px;
            }

            #editor, #bonusEditor {
                min-height: 180px !important;
            }

            .editor-container {
                height: 180px !important;
            }
        }

        /* Touch improvements */
        @media (hover: none) and (pointer: coarse) {
            /* Make all interactive elements more touch-friendly */
            button, .btn, select, input {
                min-height: 44px;
                min-width: 44px;
            }

            /* Larger tap targets */
            a, .clickable {
                padding: 8px;
            }

            /* Remove hover effects */
            .btn:hover {
                transform: none;
            }
        }

    </style>
</head>
<body oncopy="return false" oncut="return false" onpaste="return false">
    <div class="video-background">
        <video autoplay loop muted playsinline disablepictureinpicture
               src="https://mws.ru/versions/release-frontend-2025-11-10-1/main-page-video.B6sSFcu0.mp4"
               poster="https://mws.ru/versions/release-frontend-2025-11-10-1/main-page-poster.JRAOioNj.webp">
        </video>
    </div>

    <div class="header">
        <div class="logo">
            <svg width="178" height="36" viewBox="0 0 178 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_361_14081_ca)">
                    <path d="M135.375 18.0001C135.375 8.33529 143.194 0.500061 152.839 0.500061H160.414C170.058 0.500061 177.877 8.33529 177.877 18.0001C177.877 27.6648 170.058 35.5001 160.414 35.5001H152.839C143.194 35.5001 135.375 27.6648 135.375 18.0001Z" fill="white"/>
                    <path d="M164.608 17.5572V18.4428H157.024V25.9997H156.141V18.4428H148.645V17.5572H156.141V10.0031H157.024V17.5572H164.608Z" fill="#282828"/>
                    <path d="M0 18.0001C0 8.33529 7.81867 0.500061 17.463 0.500061H113.994C123.638 0.500061 131.457 8.33529 131.457 18.0001C131.457 27.6648 123.638 35.5001 113.994 35.5001H17.463C7.81867 35.5001 0 27.6648 0 18.0001Z" fill="#FF0032"/>
                    <path d="M115.444 23.3031V18.4906C115.444 16.9156 114.804 16.5205 113.676 16.5205C112.488 16.5205 111.695 17.0561 111.695 18.4906V23.3031H110.398V12.1508H111.679V16.8122C112.105 15.9425 112.991 15.558 114.041 15.558C115.796 15.558 116.74 16.4277 116.74 18.4906V23.3031H115.444ZM101.661 19.5432C101.661 16.7777 102.728 15.5554 104.924 15.5554C106.739 15.5554 107.85 16.2421 108.035 17.8171H106.723C106.556 16.8387 105.9 16.5179 104.924 16.5179C103.611 16.5179 102.971 17.2364 102.971 18.9175V20.1239C102.971 21.911 103.855 22.5076 104.924 22.5076C105.993 22.5076 106.585 22.0489 106.723 21.1925H108.048C107.834 22.7357 106.723 23.4701 104.924 23.4701C102.942 23.4701 101.661 22.5686 101.661 19.5432ZM96.3589 16.5046C95.0624 16.5046 94.3929 17.1463 94.3612 18.7504H98.3698C98.3089 17.1304 97.6368 16.5046 96.3562 16.5046H96.3589ZM93.0806 19.53C93.0806 16.6717 94.2236 15.558 96.3589 15.558C98.4941 15.558 99.6662 16.6743 99.6662 19.2092V19.5751H94.3612V20.0497C94.3612 21.7467 95.0782 22.5235 96.3589 22.5235C97.5178 22.5235 98.1131 22.0489 98.2639 21.1792H99.5604C99.317 22.6455 98.2639 23.4701 96.3589 23.4701C94.2236 23.4701 93.0806 22.3538 93.0806 19.5273V19.53ZM88.2306 13.9061H84.9841V12.7607H92.8663V13.9061H89.6038V23.3031H88.2306V13.9061ZM76.4431 16.5046C75.1466 16.5046 74.4772 17.1463 74.4454 18.7504H78.454C78.3931 17.1304 77.7211 16.5046 76.4404 16.5046H76.4431ZM73.1648 19.53C73.1648 16.6717 74.3078 15.558 76.4431 15.558C78.5783 15.558 79.7505 16.6743 79.7505 19.2092V19.5751H74.4454V20.0497C74.4454 21.7467 75.1625 22.5235 76.4431 22.5235C77.602 22.5235 78.1973 22.0489 78.3481 21.1792H79.6446C79.4012 22.6455 78.3481 23.4701 76.4431 23.4701C74.3078 23.4701 73.1648 22.3538 73.1648 19.5273V19.53ZM64.3407 20.5376V15.7251H65.6372V20.5376C65.6372 22.1126 66.2775 22.5076 67.4046 22.5076C68.5927 22.5076 69.3864 21.9879 69.3864 20.5376V15.7251H70.6829V23.3031H69.4023V22.2637C68.9763 23.1201 68.1217 23.4701 67.0395 23.4701C65.2853 23.4701 64.3407 22.6296 64.3407 20.5376ZM58.3239 15.7251H59.5595V17.1754C59.9114 16.197 60.6576 15.7251 61.6948 15.7251H62.3801V16.9315H61.6022C60.2766 16.9315 59.6204 17.5122 59.6204 18.9944V23.3031H58.3239V15.7251ZM52.958 13.9061H49.7114V12.7607H57.5936V13.9061H54.3312V23.3031H52.958V13.9061ZM36.3019 18.016C36.3019 14.1209 37.8577 12.591 40.5698 12.591C43.0252 12.591 44.2741 13.6145 44.5043 15.7834H43.1178C42.9194 14.2402 42.1415 13.7046 40.5724 13.7046C38.7891 13.7046 37.6911 14.7732 37.6911 17.3107V18.655C37.6911 21.1607 38.7732 22.3512 40.5724 22.3512C42.0965 22.3512 42.8903 21.9243 43.1337 20.3652H44.5201C44.245 22.5819 42.9961 23.4675 40.5724 23.4675C37.8577 23.4675 36.3046 21.9402 36.3046 18.0133L36.3019 18.016ZM30.4227 13.9061H27.1762V12.7607H35.0584V13.9061H31.796V23.3031H30.4227V13.9061ZM19.1935 23.3031L16.1586 13.9379V23.3031H14.9071V12.7607H17.0556L19.982 21.9137L22.9692 12.7607H25.0118V23.3031H23.6386V13.983L20.5905 23.3031H19.1882H19.1935Z" fill="white"/>
                </g>
                <defs>
                    <clipPath id="clip0_361_14081_ca">
                        <rect width="178" height="35" fill="white" transform="translate(0 0.5)"/>
                    </clipPath>
                </defs>
            </svg>
        </div>
        <div class="stats">
            <div class="stat-item">
                <div class="stat-label">–†–∞—É–Ω–¥</div>
                <div class="stat-value" id="round">0/5</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">–í—Ä–µ–º—è</div>
                <div class="stat-value" id="timer">0.0</div>
            </div>
        </div>
        <button id="finishBtn" class="finish-btn" onclick="finishGame()" style="display: none;">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
    </div>

    <div class="main-container">
        <div id="gameArea" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>

            <div class="code-display">
                <div class="code-label" id="codeLabel">–ù–∞–ø–µ—á–∞—Ç–∞–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥:</div>
                <div class="code-target" id="targetCode"></div>
            </div>

            <div id="bugDescription" style="display: none; background: #fff3cd; border: 3px solid #888; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                <div style="font-size: 14px; color: #666; font-weight: bold; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;">üêõ –û–ø–∏—Å–∞–Ω–∏–µ –±–∞–≥–∞:</div>
                <div id="bugDescriptionText" style="font-size: 16px; color: #333; line-height: 1.6;"></div>
            </div>

            <div class="editor-container">
                <div id="editor"></div>
            </div>

            <div class="feedback" id="feedback"></div>
        </div>

        <div id="startScreen" class="instructions">
            <h2>–¢–ï–ö–ò LOW-–ö–û–î–ò–ù–ì üèóÔ∏è</h2>
            <p style="font-size: 18px; margin: 20px 0; color: #555;">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –°—Ç—Ä–∞—Ç–µ–≥–æ–≤. –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å –ø–ª–∞–Ω –∏ –º—ã—Å–ª–∏—Ç—å –Ω–∞ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—É.</p>

            <div style="margin-top: 40px;">
                <button class="btn btn-primary" onclick="startArchitectGame()" style="font-size: 18px; padding: 18px 36px;">
                    –ù–∞—á–∞—Ç—å –∏–≥—Ä—É üèóÔ∏è
                </button>
            </div>

            <div style="margin-top: 40px; padding: 30px; background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%); border-radius: 12px; border-left: 5px solid #6c757d; box-shadow: 0 2px 8px rgba(108, 117, 125, 0.15); text-align: left;">
                <h3 style="margin: 0 0 25px 0; color: #495057; font-size: 22px; font-weight: 600; letter-spacing: 0.5px;">üìã –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h3>

                <div style="margin: 0 0 25px 0; padding: 18px; background: white; border-radius: 8px; border: 1px solid #dee2e6;">
                    <p style="margin: 0 0 12px 0; color: #2c3e50; font-size: 15px; line-height: 1.6;"><strong style="color: #495057;">‚è± –í—Ä–µ–º—è:</strong> 10 –º–∏–Ω—É—Ç –Ω–∞ –≤—Å—é –∏–≥—Ä—É</p>
                    <p style="margin: 0 0 12px 0; color: #2c3e50; font-size: 15px; line-height: 1.6;"><strong style="color: #495057;">üéØ –¶–µ–ª—å:</strong> –ü—Ä–æ–π—Ç–∏ –≤—Å–µ 7 —É—Ä–æ–≤–Ω–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã</p>
                    <p style="margin: 0 0 12px 0; color: #2c3e50; font-size: 15px; line-height: 1.6;"><strong style="color: #495057;">üî¢ –£—Ä–æ–≤–Ω–∏:</strong> 7 –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –∑–∞–¥–∞—á + –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</p>
                    <p style="margin: 0; color: #2c3e50; font-size: 15px; line-height: 1.6;"><strong style="color: #dc3545;">‚ö†Ô∏è –õ–∏–º–∏—Ç:</strong> <span style="color: #dc3545; font-weight: 600;">–í—Å–µ–≥–æ 5 –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ –≤—Å—é –∏–≥—Ä—É!</span></p>
                </div>

                <div style="margin: 0 0 25px 0;">
                    <p style="margin: 0 0 15px 0; color: #2c3e50; font-weight: 600; font-size: 16px;">–ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</p>
                    <ul style="margin: 0; padding-left: 24px; color: #555; line-height: 1.8; text-align: left;">
                        <li style="margin: 0 0 12px 0; font-size: 15px;"><strong style="color: #495057;">–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–∞—É–Ω–¥—ã:</strong> –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –±–ª–æ–∫–∏ –Ω–∞ canvas –∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –Ω–∏–º–∏</li>
                        <li style="margin: 0 0 12px 0; font-size: 15px;"><strong style="color: #495057;">–†–∞—É–Ω–¥—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:</strong> –ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö</li>
                        <li style="margin: 0 0 12px 0; font-size: 15px;">–°–ª–µ–¥—É–π—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è</li>
                        <li style="margin: 0; font-size: 15px;">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</li>
                    </ul>
                </div>

                <div style="margin: 0 0 25px 0; padding: 20px; background: #fff3cd; border-radius: 8px; border: 2px solid #ffc107;">
                    <p style="margin: 0 0 15px 0; color: #dc3545; font-weight: 600; font-size: 17px; text-align: center;">‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤</p>
                    <div style="display: grid; gap: 8px; text-align: left;">
                        <div style="padding: 10px; background: white; border-radius: 6px; border-left: 3px solid #ffc107;">
                            <strong style="color: #495057;">1-—è –æ—à–∏–±–∫–∞:</strong> <span style="color: #856404;">‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</span>
                        </div>
                        <div style="padding: 10px; background: white; border-radius: 6px; border-left: 3px solid #fd7e14;">
                            <strong style="color: #495057;">2-—è –æ—à–∏–±–∫–∞:</strong> <span style="color: #fd7e14; font-weight: 600;">üç∫ –ü—å–µ—Ç–µ!</span>
                        </div>
                        <div style="padding: 10px; background: white; border-radius: 6px; border-left: 3px solid #ffc107;">
                            <strong style="color: #495057;">3-—è –æ—à–∏–±–∫–∞:</strong> <span style="color: #856404;">‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</span>
                        </div>
                        <div style="padding: 10px; background: white; border-radius: 6px; border-left: 3px solid #fd7e14;">
                            <strong style="color: #495057;">4-—è –æ—à–∏–±–∫–∞:</strong> <span style="color: #fd7e14; font-weight: 600;">üç∫ –°–Ω–æ–≤–∞ –ø—å–µ—Ç–µ!</span>
                        </div>
                        <div style="padding: 10px; background: white; border-radius: 6px; border-left: 3px solid #dc3545;">
                            <strong style="color: #495057;">5-—è –æ—à–∏–±–∫–∞:</strong> <span style="color: #dc3545; font-weight: 700;">‚ùå GAME OVER!</span>
                        </div>
                    </div>
                </div>

                <div style="margin: 0; padding: 18px; background: #d4edda; border-radius: 8px; border: 1px solid #28a745;">
                    <p style="margin: 0 0 15px 0; color: #28a745; font-weight: 600; font-size: 16px;">‚úÖ –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:</p>
                    <ul style="margin: 0; padding-left: 24px; color: #155724; line-height: 1.8; text-align: left;">
                        <li style="margin: 0 0 10px 0; font-size: 15px;">–®—Ç—Ä–∞—Ñ—ã —Å—á–∏—Ç–∞—é—Ç—Å—è –ó–ê –û–ë–ê —Ç–∏–ø–∞ —Ä–∞—É–Ω–¥–æ–≤ (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ + –∫–æ–Ω—Ñ–∏–≥–∏)</li>
                        <li style="margin: 0 0 10px 0; font-size: 15px;">–ö–∞–∂–¥—ã–π —Ä–∞—É–Ω–¥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –û–ë–Ø–ó–ê–¢–ï–õ–ï–ù - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–µ–ª—å–∑—è!</li>
                        <li style="margin: 0; font-size: 15px;">–î–ª—è –ø–æ–±–µ–¥—ã –Ω—É–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –≤—Å–µ 7 —É—Ä–æ–≤–Ω–µ–π –∑–∞ 5 –ø–æ–ø—ã—Ç–æ–∫</li>
                    </ul>
                </div>
            </div>
        </div>

        <div id="architectArea" style="display: none;">
            <div style="padding: 15px 30px;">
                <div class="code-display" style="margin-bottom: 10px; padding: 12px;">
                    <div class="code-label" style="color: #666; font-size: 14px; margin-bottom: 6px;">üéØ –ó–∞–¥–∞—á–∞:</div>
                    <div id="architectTask" style="font-size: 13px; line-height: 1.3; color: #333;"></div>
                    <div id="architectRequirements" style="margin-top: 8px; padding: 8px; background: #f0f0f0; border-radius: 5px; font-size: 12px;"></div>
                    <div id="attemptsDisplay" style="margin-top: 8px; padding: 8px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 5px; font-size: 13px; font-weight: bold; text-align: center;"></div>
                </div>

                <div style="display: flex; gap: 15px; height: calc(100vh - 320px); max-height: 450px;">
                    <div id="blockPanel" style="width: 180px; background: white; border: 3px solid #ff0032; border-radius: 10px; padding: 12px; overflow-y: auto;">
                        <div style="font-size: 12px; color: #ff0032; font-weight: bold; margin-bottom: 10px; text-transform: uppercase;">–î–æ—Å—Ç—É–ø–Ω—ã–µ –±–ª–æ–∫–∏:</div>
                        <div id="availableBlocks"></div>
                    </div>

                    <div style="flex: 1; position: relative;">
                        <div id="canvas" style="width: 100%; height: 100%; background: white; border: 3px solid #ff0032; border-radius: 10px; position: relative; overflow: hidden;">
                            <svg id="connectionsSvg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;"></svg>
                            <div id="droppedBlocks" style="position: relative; width: 100%; height: 100%; z-index: 2;"></div>
                        </div>
                    </div>
                </div>

                <div class="controls" style="margin-top: 10px; margin-bottom: 5px;">
                    <button class="btn btn-primary" onclick="checkArchitecture()" id="checkBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    <button class="btn btn-secondary" onclick="clearCanvas()">–û—á–∏—Å—Ç–∏—Ç—å</button>
                    <button class="btn btn-secondary" onclick="showHint()" id="hintBtn">–ü–æ–¥—Å–∫–∞–∑–∫–∞</button>
                </div>

                <div class="feedback" id="architectFeedback" style="min-height: 25px;"></div>
            </div>
        </div>

        <div id="bonusConfigArea" style="display: none;">
            <div style="padding: 15px 30px;">
                <div class="code-display" style="margin-bottom: 15px; padding: 15px; text-align: center;">
                    <div style="font-size: 28px; color: #ff0032; font-weight: bold; margin-bottom: 10px;">‚öôÔ∏è –ò–°–ü–†–ê–í–¨–¢–ï –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Æ!</div>
                    <div style="font-size: 16px; color: #666; margin-bottom: 8px;">–ò—Å–ø—Ä–∞–≤—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é!</div>
                    <div id="bonusHint" style="font-size: 14px; color: #333; background: #fff9e6; padding: 10px; border-radius: 5px; border: 1px solid #ffd700;"></div>
                </div>

                <div style="border: 3px solid #ff0032; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 20px rgba(255, 0, 50, 0.15); margin-bottom: 15px;">
                    <div id="bonusEditor" style="height: 400px;"></div>
                </div>

                <div class="controls" style="margin-bottom: 10px;">
                    <button class="btn btn-primary" onclick="checkBonusConfig()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ üîç</button>
                </div>

                <div class="feedback" id="bonusFeedback" style="min-height: 25px;"></div>
            </div>
        </div>

        <div id="finalScreen" class="final-screen">
            <div class="final-screen-content">
                <h2 id="finalTitle">üéâ –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>

                <!-- Results Summary -->
                <div class="final-stats">
                    <div class="final-stat-card">
                        <div class="final-stat-label">–†–∞—É–Ω–¥–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                        <div class="final-stat-value" id="finalRoundsCompleted">0</div>
                    </div>

                    <div class="final-stat-card">
                        <div class="final-stat-label">–ó–∞—Ç—Ä–∞—á–µ–Ω–æ –≤—Ä–µ–º–µ–Ω–∏</div>
                        <div class="final-stat-value" id="finalTimeSpent">0:00</div>
                    </div>
                </div>

                <!-- Mode-specific message -->
                <div class="final-message" id="finalModeMessage"></div>

                <!-- Actions -->
                <div class="controls">
                    <button class="btn btn-primary" onclick="restartGame()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ üîÑ</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
    <script>
        // –ó–∞–±–∞–≤–Ω—ã–µ –∫—É—Å–∫–∏ –∫–æ–¥–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏ (—Å —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–µ–π—Å—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é)
        const codeSnippets = [
            {
                code: `// Hello, World!
console.log('MWS');`,
                difficulty: 1
            },
            {
                code: `const bug = 'fixed';
if (bug) {
  console.log('found!');
}`,
                difficulty: 1.5
            },
            {
                code: `function makeCloud() {
  return 'cloud'.repeat(99);
}
makeCloud();`,
                difficulty: 2
            },
            {
                code: `const data = [1, 2, 3];
const magic = data
  .map(x => x * x)
  .filter(x => x > 5);`,
                difficulty: 2.5
            },
            {
                code: `async function deploy() {
  const cloud = await MWS();
  cloud.scale(Infinity);
  return 'PROFIT!';
}`,
                difficulty: 3
            }
        ];

        // –ë–∞–≥–∏ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Å —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–µ–π—Å—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é)
        // –°—Ç—Ä—É–∫—Ç—É—Ä–∞: —è–∑—ã–∫ -> –º–∞—Å—Å–∏–≤ –±–∞–≥–æ–≤
        const bugScenariosByLanguage = {
            'javascript': [
                {
                    description: "–§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç undefined –≤–º–µ—Å—Ç–æ —Å—É–º–º—ã –¥–≤—É—Ö —á–∏—Å–µ–ª",
                    buggyCode: `function add(a, b) {
  const result = a + b;
}
add(2, 3);`,
                    fixedCode: `function add(a, b) {
  const result = a + b;
  return result;
}
add(2, 3);`,
                    difficulty: 1,
                    hint: "–ó–∞–±—ã–ª–∏ –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç?"
                },
                {
                    description: "–ú–∞—Å—Å–∏–≤ –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ - –æ—Å—Ç–∞—é—Ç—Å—è –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã",
                    buggyCode: `const numbers = [1, 2, 3, 4, 5];
const even = numbers.filter(n => {
  n % 2 === 0;
});
console.log(even);`,
                    fixedCode: `const numbers = [1, 2, 3, 4, 5];
const even = numbers.filter(n => {
  return n % 2 === 0;
});
console.log(even);`,
                    difficulty: 1.5,
                    hint: "Arrow function —Å —Ñ–∏–≥—É—Ä–Ω—ã–º–∏ —Å–∫–æ–±–∫–∞–º–∏ —Ç—Ä–µ–±—É–µ—Ç return"
                },
                {
                    description: "–¶–∏–∫–ª –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≤–∏—Å–∞–µ—Ç!",
                    buggyCode: `let count = 0;
while (count < 5) {
  console.log(count);
}
console.log('Done!');`,
                    fixedCode: `let count = 0;
while (count < 5) {
  console.log(count);
  count++;
}
console.log('Done!');`,
                    difficulty: 2,
                    hint: "–ß—Ç–æ-—Ç–æ –º–µ—à–∞–µ—Ç —Ü–∏–∫–ª—É –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è..."
                },
                {
                    description: "Promise –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–∞—é—Ç—Å—è (–Ω–µ—Å–∫–æ–ª—å–∫–æ –±–∞–≥–æ–≤)",
                    buggyCode: `async function getData() {
  const response = fetch('/api/data');
  const data = response.json();
  return data;
}

getData().then(result => {
  console.log(result);
});`,
                    fixedCode: `async function getData() {
  const response = await fetch('/api/data');
  const data = await response.json();
  return data;
}

getData().then(result => {
  console.log(result);
});`,
                    difficulty: 2.5,
                    hint: "Async —Ñ—É–Ω–∫—Ü–∏—è –±–µ–∑ await - —ç—Ç–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ"
                },
                {
                    description: "–û–±—ä–µ–∫—Ç –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ state –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ —Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è (3+ –±–∞–≥–∞)",
                    buggyCode: `const state = { count: 0, users: [] };

function updateCount(newCount) {
  state.count = newCount;
}

function addUser(user) {
  state.users.push(user);
  return state;
}

const newState = addUser({ id: 1 });`,
                    fixedCode: `const state = { count: 0, users: [] };

function updateCount(newCount) {
  return { ...state, count: newCount };
}

function addUser(user) {
  return {
    ...state,
    users: [...state.users, user]
  };
}

const newState = addUser({ id: 1 });`,
                    difficulty: 3,
                    hint: "–ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å - –∫–ª—é—á –∫ —Å—á–∞—Å—Ç—å—é –≤ React/Redux"
                }
            ],
            'python': [
                {
                    description: "–§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç None –≤–º–µ—Å—Ç–æ —Å—É–º–º—ã –¥–≤—É—Ö —á–∏—Å–µ–ª",
                    buggyCode: `def add(a, b):
    result = a + b

print(add(2, 3))`,
                    fixedCode: `def add(a, b):
    result = a + b
    return result

print(add(2, 3))`,
                    difficulty: 1,
                    hint: "–ó–∞–±—ã–ª–∏ –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç?"
                },
                {
                    description: "List comprehension –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç None –≤–º–µ—Å—Ç–æ —Å–ø–∏—Å–∫–∞ —á–∏—Å–µ–ª",
                    buggyCode: `numbers = [1, 2, 3, 4, 5]
even = [n for n in numbers if n % 2 == 0
        for _ in [print(n)]]
print(even)`,
                    fixedCode: `numbers = [1, 2, 3, 4, 5]
even = [n for n in numbers if n % 2 == 0]
print(even)`,
                    difficulty: 1.5,
                    hint: "List comprehension –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã"
                },
                {
                    description: "–¶–∏–∫–ª –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ - –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–∏—Å–∞–µ—Ç!",
                    buggyCode: `count = 0
while count < 5:
    print(count)

print('Done!')`,
                    fixedCode: `count = 0
while count < 5:
    print(count)
    count += 1

print('Done!')`,
                    difficulty: 2,
                    hint: "–ß—Ç–æ-—Ç–æ –º–µ—à–∞–µ—Ç —Ü–∏–∫–ª—É –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è..."
                },
                {
                    description: "–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –∂–¥–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–Ω–µ—Å–∫–æ–ª—å–∫–æ –±–∞–≥–æ–≤)",
                    buggyCode: `import asyncio

async def get_data():
    response = asyncio.sleep(1)
    data = {'result': 'success'}
    return data

asyncio.run(get_data())`,
                    fixedCode: `import asyncio

async def get_data():
    await asyncio.sleep(1)
    data = {'result': 'success'}
    return data

asyncio.run(get_data())`,
                    difficulty: 2.5,
                    hint: "Async —Ñ—É–Ω–∫—Ü–∏—è –±–µ–∑ await - —ç—Ç–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ"
                },
                {
                    description: "–°–ª–æ–≤–∞—Ä—å –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–ø–∏–∏ (3+ –±–∞–≥–∞)",
                    buggyCode: `state = {'count': 0, 'users': []}

def update_count(new_count):
    state['count'] = new_count

def add_user(user):
    state['users'].append(user)
    return state

new_state = add_user({'id': 1})`,
                    fixedCode: `state = {'count': 0, 'users': []}

def update_count(new_count):
    return {**state, 'count': new_count}

def add_user(user):
    return {
        **state,
        'users': [*state['users'], user]
    }

new_state = add_user({'id': 1})`,
                    difficulty: 3,
                    hint: "–ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å - –ª—É—á—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è state management"
                }
            ],
            'cpp': [
                {
                    description: "–§—É–Ω–∫—Ü–∏—è –Ω–∏—á–µ–≥–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–º–µ—Å—Ç–æ —Å—É–º–º—ã –¥–≤—É—Ö —á–∏—Å–µ–ª",
                    buggyCode: `#include <iostream>

int add(int a, int b) {
    int result = a + b;
}

int main() {
    add(2, 3);
    return 0;
}`,
                    fixedCode: `#include <iostream>

int add(int a, int b) {
    int result = a + b;
    return result;
}

int main() {
    add(2, 3);
    return 0;
}`,
                    difficulty: 1,
                    hint: "–ó–∞–±—ã–ª–∏ –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç?"
                },
                {
                    description: "–õ—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç bool –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏",
                    buggyCode: `#include <vector>
#include <algorithm>
using namespace std;

int main() {
    vector<int> nums = {1,2,3,4,5};
    vector<int> even;
    copy_if(nums.begin(), nums.end(),
            back_inserter(even),
            [](int n) { n % 2 == 0; });
    return 0;
}`,
                    fixedCode: `#include <vector>
#include <algorithm>
using namespace std;

int main() {
    vector<int> nums = {1,2,3,4,5};
    vector<int> even;
    copy_if(nums.begin(), nums.end(),
            back_inserter(even),
            [](int n) { return n % 2 == 0; });
    return 0;
}`,
                    difficulty: 1.5,
                    hint: "–õ—è–º–±–¥–∞ –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç"
                },
                {
                    description: "–¶–∏–∫–ª –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ - –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–∏—Å–∞–µ—Ç!",
                    buggyCode: `#include <iostream>
using namespace std;

int main() {
    int count = 0;
    while (count < 5) {
        cout << count << endl;
    }
    cout << "Done!" << endl;
    return 0;
}`,
                    fixedCode: `#include <iostream>
using namespace std;

int main() {
    int count = 0;
    while (count < 5) {
        cout << count << endl;
        count++;
    }
    cout << "Done!" << endl;
    return 0;
}`,
                    difficulty: 2,
                    hint: "–ß—Ç–æ-—Ç–æ –º–µ—à–∞–µ—Ç —Ü–∏–∫–ª—É –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è..."
                },
                {
                    description: "Future –Ω–µ –∂–¥–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏",
                    buggyCode: `#include <future>
#include <iostream>
using namespace std;

int get_data() {
    this_thread::sleep_for(1s);
    return 42;
}

int main() {
    auto result = async(get_data);
    cout << result << endl;
    return 0;
}`,
                    fixedCode: `#include <future>
#include <iostream>
using namespace std;

int get_data() {
    this_thread::sleep_for(1s);
    return 42;
}

int main() {
    auto result = async(get_data);
    cout << result.get() << endl;
    return 0;
}`,
                    difficulty: 2.5,
                    hint: "–ù—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å .get() —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç"
                },
                {
                    description: "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∫–æ–ø–∏–∏",
                    buggyCode: `#include <vector>
using namespace std;

struct State {
    int count;
    vector<int> users;
};

State update_count(State& s, int n) {
    s.count = n;
    return s;
}

int main() {
    State state{0, {}};
    update_count(state, 5);
    return 0;
}`,
                    fixedCode: `#include <vector>
using namespace std;

struct State {
    int count;
    vector<int> users;
};

State update_count(const State& s, int n) {
    State new_state = s;
    new_state.count = n;
    return new_state;
}

int main() {
    State state{0, {}};
    update_count(state, 5);
    return 0;
}`,
                    difficulty: 3,
                    hint: "–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–æ–ø–∏—é –≤–º–µ—Å—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª–∞"
                }
            ],
            'csharp': [
                {
                    description: "–ú–µ—Ç–æ–¥ –Ω–∏—á–µ–≥–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–º–µ—Å—Ç–æ —Å—É–º–º—ã –¥–≤—É—Ö —á–∏—Å–µ–ª",
                    buggyCode: `using System;

class Program {
    static int Add(int a, int b) {
        int result = a + b;
    }

    static void Main() {
        Add(2, 3);
    }
}`,
                    fixedCode: `using System;

class Program {
    static int Add(int a, int b) {
        int result = a + b;
        return result;
    }

    static void Main() {
        Add(2, 3);
    }
}`,
                    difficulty: 1,
                    hint: "–ó–∞–±—ã–ª–∏ –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç?"
                },
                {
                    description: "LINQ Where –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç bool –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏",
                    buggyCode: `using System;
using System.Linq;

class Program {
    static void Main() {
        var numbers = new[] {1,2,3,4,5};
        var even = numbers.Where(n => {
            n % 2 == 0;
        });
        Console.WriteLine(even.Count());
    }
}`,
                    fixedCode: `using System;
using System.Linq;

class Program {
    static void Main() {
        var numbers = new[] {1,2,3,4,5};
        var even = numbers.Where(n => {
            return n % 2 == 0;
        });
        Console.WriteLine(even.Count());
    }
}`,
                    difficulty: 1.5,
                    hint: "–õ—è–º–±–¥–∞ —Å —Ñ–∏–≥—É—Ä–Ω—ã–º–∏ —Å–∫–æ–±–∫–∞–º–∏ —Ç—Ä–µ–±—É–µ—Ç return"
                },
                {
                    description: "–¶–∏–∫–ª –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ - –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–∏—Å–∞–µ—Ç!",
                    buggyCode: `using System;

class Program {
    static void Main() {
        int count = 0;
        while (count < 5) {
            Console.WriteLine(count);
        }
        Console.WriteLine("Done!");
    }
}`,
                    fixedCode: `using System;

class Program {
    static void Main() {
        int count = 0;
        while (count < 5) {
            Console.WriteLine(count);
            count++;
        }
        Console.WriteLine("Done!");
    }
}`,
                    difficulty: 2,
                    hint: "–ß—Ç–æ-—Ç–æ –º–µ—à–∞–µ—Ç —Ü–∏–∫–ª—É –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è..."
                },
                {
                    description: "Task –Ω–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è",
                    buggyCode: `using System;
using System.Threading.Tasks;

class Program {
    static async Task<int> GetData() {
        var result = Task.Delay(1000);
        return 42;
    }

    static void Main() {
        GetData();
    }
}`,
                    fixedCode: `using System;
using System.Threading.Tasks;

class Program {
    static async Task<int> GetData() {
        await Task.Delay(1000);
        return 42;
    }

    static void Main() {
        GetData();
    }
}`,
                    difficulty: 2.5,
                    hint: "Async –º–µ—Ç–æ–¥ –±–µ–∑ await - —ç—Ç–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ"
                },
                {
                    description: "Record –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤–º–µ—Å—Ç–æ with-–≤—ã—Ä–∞–∂–µ–Ω–∏—è",
                    buggyCode: `using System.Collections.Generic;

record State(int Count, List<int> Users);

class Program {
    static State UpdateCount(State s, int n) {
        s.Count = n;
        return s;
    }

    static void Main() {
        var state = new State(0, new());
        UpdateCount(state, 5);
    }
}`,
                    fixedCode: `using System.Collections.Generic;

record State(int Count, List<int> Users);

class Program {
    static State UpdateCount(State s, int n) {
        return s with { Count = n };
    }

    static void Main() {
        var state = new State(0, new());
        UpdateCount(state, 5);
    }
}`,
                    difficulty: 3,
                    hint: "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ with –¥–ª—è –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π"
                }
            ],
            'java': [
                {
                    description: "–ú–µ—Ç–æ–¥ –Ω–∏—á–µ–≥–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–º–µ—Å—Ç–æ —Å—É–º–º—ã –¥–≤—É—Ö —á–∏—Å–µ–ª",
                    buggyCode: `public class Main {
    static int add(int a, int b) {
        int result = a + b;
    }

    public static void main(String[] args) {
        add(2, 3);
    }
}`,
                    fixedCode: `public class Main {
    static int add(int a, int b) {
        int result = a + b;
        return result;
    }

    public static void main(String[] args) {
        add(2, 3);
    }
}`,
                    difficulty: 1,
                    hint: "–ó–∞–±—ã–ª–∏ –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç?"
                },
                {
                    description: "Stream filter –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç boolean –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏",
                    buggyCode: `import java.util.*;
import java.util.stream.*;

public class Main {
    public static void main(String[] args) {
        var nums = List.of(1,2,3,4,5);
        var even = nums.stream()
            .filter(n -> {
                n % 2 == 0;
            })
            .toList();
        System.out.println(even.size());
    }
}`,
                    fixedCode: `import java.util.*;
import java.util.stream.*;

public class Main {
    public static void main(String[] args) {
        var nums = List.of(1,2,3,4,5);
        var even = nums.stream()
            .filter(n -> {
                return n % 2 == 0;
            })
            .toList();
        System.out.println(even.size());
    }
}`,
                    difficulty: 1.5,
                    hint: "–õ—è–º–±–¥–∞ —Å —Ñ–∏–≥—É—Ä–Ω—ã–º–∏ —Å–∫–æ–±–∫–∞–º–∏ —Ç—Ä–µ–±—É–µ—Ç return"
                },
                {
                    description: "–¶–∏–∫–ª –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ - –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–∏—Å–∞–µ—Ç!",
                    buggyCode: `public class Main {
    public static void main(String[] args) {
        int count = 0;
        while (count < 5) {
            System.out.println(count);
        }
        System.out.println("Done!");
    }
}`,
                    fixedCode: `public class Main {
    public static void main(String[] args) {
        int count = 0;
        while (count < 5) {
            System.out.println(count);
            count++;
        }
        System.out.println("Done!");
    }
}`,
                    difficulty: 2,
                    hint: "–ß—Ç–æ-—Ç–æ –º–µ—à–∞–µ—Ç —Ü–∏–∫–ª—É –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è..."
                },
                {
                    description: "CompletableFuture –Ω–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è",
                    buggyCode: `import java.util.concurrent.*;

public class Main {
    static CompletableFuture<Integer> getData() {
        var future = CompletableFuture
            .runAsync(() -> {
                Thread.sleep(1000);
            });
        return CompletableFuture
            .completedFuture(42);
    }

    public static void main(String[] args) {
        getData();
    }
}`,
                    fixedCode: `import java.util.concurrent.*;

public class Main {
    static CompletableFuture<Integer> getData() {
        return CompletableFuture
            .supplyAsync(() -> {
                try { Thread.sleep(1000); }
                catch (Exception e) {}
                return 42;
            });
    }

    public static void main(String[] args) {
        getData();
    }
}`,
                    difficulty: 2.5,
                    hint: "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ supplyAsync –≤–º–µ—Å—Ç–æ runAsync –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∑–Ω–∞—á–µ–Ω–∏—è"
                },
                {
                    description: "–ö–æ–ª–ª–µ–∫—Ü–∏—è –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π",
                    buggyCode: `import java.util.*;

class State {
    int count;
    List<Integer> users;
}

public class Main {
    static State updateCount(State s, int n) {
        s.count = n;
        return s;
    }

    public static void main(String[] args) {
        var state = new State();
        state.count = 0;
        state.users = new ArrayList<>();
        updateCount(state, 5);
    }
}`,
                    fixedCode: `import java.util.*;

record State(int count, List<Integer> users) {}

public class Main {
    static State updateCount(State s, int n) {
        return new State(n, s.users());
    }

    public static void main(String[] args) {
        var state = new State(0,
            new ArrayList<>());
        updateCount(state, 5);
    }
}`,
                    difficulty: 3,
                    hint: "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ records –¥–ª—è –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏"
                }
            ],
            'golang': [
                {
                    description: "–§—É–Ω–∫—Ü–∏—è –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—É–º–º—ã –¥–≤—É—Ö —á–∏—Å–µ–ª",
                    buggyCode: `package main

import "fmt"

func add(a, b int) int {
    result := a + b
}

func main() {
    add(2, 3)
}`,
                    fixedCode: `package main

import "fmt"

func add(a, b int) int {
    result := a + b
    return result
}

func main() {
    add(2, 3)
}`,
                    difficulty: 1,
                    hint: "–ó–∞–±—ã–ª–∏ –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç?"
                },
                {
                    description: "–ê–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤ filter –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç bool",
                    buggyCode: `package main

import "fmt"

func main() {
    numbers := []int{1,2,3,4,5}
    var even []int
    for _, n := range numbers {
        if func(x int) { x%2 == 0 }(n) {
            even = append(even, n)
        }
    }
    fmt.Println(even)
}`,
                    fixedCode: `package main

import "fmt"

func main() {
    numbers := []int{1,2,3,4,5}
    var even []int
    for _, n := range numbers {
        if func(x int) bool {
            return x%2 == 0
        }(n) {
            even = append(even, n)
        }
    }
    fmt.Println(even)
}`,
                    difficulty: 1.5,
                    hint: "–§—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å bool"
                },
                {
                    description: "–¶–∏–∫–ª –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ - –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–∏—Å–∞–µ—Ç!",
                    buggyCode: `package main

import "fmt"

func main() {
    count := 0
    for count < 5 {
        fmt.Println(count)
    }
    fmt.Println("Done!")
}`,
                    fixedCode: `package main

import "fmt"

func main() {
    count := 0
    for count < 5 {
        fmt.Println(count)
        count++
    }
    fmt.Println("Done!")
}`,
                    difficulty: 2,
                    hint: "–ß—Ç–æ-—Ç–æ –º–µ—à–∞–µ—Ç —Ü–∏–∫–ª—É –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è..."
                },
                {
                    description: "–ì–æ—Ä—É—Ç–∏–Ω–∞ –Ω–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Ä—è–µ—Ç—Å—è",
                    buggyCode: `package main

import (
    "fmt"
    "time"
)

func getData() int {
    go func() {
        time.Sleep(1 * time.Second)
    }()
    return 42
}

func main() {
    result := getData()
    fmt.Println(result)
}`,
                    fixedCode: `package main

import (
    "fmt"
    "time"
)

func getData() int {
    done := make(chan int)
    go func() {
        time.Sleep(1 * time.Second)
        done <- 42
    }()
    return <-done
}

func main() {
    result := getData()
    fmt.Println(result)
}`,
                    difficulty: 2.5,
                    hint: "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–Ω–∞–ª—ã –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≥–æ—Ä—É—Ç–∏–Ω"
                },
                {
                    description: "Slice –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–ø–∏–∏",
                    buggyCode: `package main

type State struct {
    Count int
    Users []int
}

func updateCount(s *State, n int) *State {
    s.Count = n
    return s
}

func main() {
    state := &State{0, []int{}}
    updateCount(state, 5)
}`,
                    fixedCode: `package main

type State struct {
    Count int
    Users []int
}

func updateCount(s State, n int) State {
    return State{
        Count: n,
        Users: s.Users,
    }
}

func main() {
    state := State{0, []int{}}
    updateCount(state, 5)
}`,
                    difficulty: 3,
                    hint: "–í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–º–µ—Å—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ —É–∫–∞–∑–∞—Ç–µ–ª—é"
                }
            ]
        };

        // Backwards compatibility - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é bugScenarios –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞
        let bugScenarios = bugScenariosByLanguage['javascript'];

        // –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –¥–ª—è Cloud Architect
        const architectureLevels = [
            {
                name: "–£—Ä–æ–≤–µ–Ω—å 1: –ü—Ä–æ—Å—Ç–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",
                description: "–°—Ç–∞—Ä—Ç–∞–ø –∑–∞–ø—É—Å–∫–∞–µ—Ç MVP –ø—Ä–æ–¥—É–∫—Ç–∞. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é 3-tier –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",
                requirements: "–ö–ª–∞—Å—Å–∏–∫–∞: Frontend (React/Vue) ‚Üí Backend API (Node.js/Python) ‚Üí Database (PostgreSQL/MongoDB)",
                availableBlocks: ['Frontend', 'Backend API', 'Database', 'Cache'],
                requiredBlocks: ['Frontend', 'Backend API', 'Database'],
                requiredConnections: [
                    {from: 'Frontend', to: 'Backend API'},
                    {from: 'Backend API', to: 'Database'}
                ],
                difficulty: 1,
                hint: "üí° –ë–∞–∑–æ–≤—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω: –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å ‚Üí API –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç ‚Üí –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç",
                bonusConfigBuggy: `version: '3.8'
services:
  frontend:
    image: nginx:latest
    ports:
      - "80:80"

  backend:
    image: node:18
    ports:
      - "3000:3000"
    environment:
      - DB_HOST=database
      - DB_PORT=5432

  database:
    image: postgres:15
    ports:
      - "5433:5432"
    environment:
      - POSTGRES_PASSWORD=secret`,
                bonusConfigFixed: `version: '3.8'
services:
  frontend:
    image: nginx:latest
    ports:
      - "80:80"

  backend:
    image: node:18
    ports:
      - "3000:3000"
    environment:
      - DB_HOST=database
      - DB_PORT=5432

  database:
    image: postgres:15
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_PASSWORD=secret`,
                bonusConfigHint: "üéØ –ò—Å–ø—Ä–∞–≤—å—Ç–µ –ø–æ—Ä—Ç PostgreSQL - –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º 5432",
                bonusConfigLanguage: "yaml"
            },
            {
                name: "–£—Ä–æ–≤–µ–Ω—å 2: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏",
                description: "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞—Å—Ç–µ—Ç! –ù—É–∂–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤—Ö–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å JWT-—Ç–æ–∫–µ–Ω–∞–º–∏ –∏ —Å–µ—Å—Å–∏—è–º–∏",
                requirements: "–î–æ–±–∞–≤—å—Ç–µ Auth Service –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π",
                availableBlocks: ['Frontend', 'Backend API', 'Database', 'Auth Service', 'Redis', 'Load Balancer'],
                requiredBlocks: ['Frontend', 'Backend API', 'Database', 'Auth Service', 'Redis'],
                requiredConnections: [
                    {from: 'Frontend', to: 'Backend API'},
                    {from: 'Backend API', to: 'Auth Service'},
                    {from: 'Auth Service', to: 'Database'},
                    {from: 'Auth Service', to: 'Redis'}
                ],
                difficulty: 1.5,
                hint: "üí° Auth Service –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–æ–≥–∏–Ω—ã/–ø–∞—Ä–æ–ª–∏ –≤ Database –∏ —Ö—Ä–∞–Ω–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –≤ Redis –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞",
                bonusConfigBuggy: `{
  "jwt": {
    "secret": "my-secret-key",
    "expiresIn": "24d",
    "algorithm": "HS256"
  },
  "redis": {
    "host": "localhost",
    "port": 6379,
    "ttl": 86400
  },
  "session": {
    "maxAge": 86400000,
    "secure": true
  }
}`,
                bonusConfigFixed: `{
  "jwt": {
    "secret": "my-secret-key",
    "expiresIn": "24h",
    "algorithm": "HS256"
  },
  "redis": {
    "host": "localhost",
    "port": 6379,
    "ttl": 86400
  },
  "session": {
    "maxAge": 86400000,
    "secure": true
  }
}`,
                bonusConfigHint: "üéØ JWT —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 24... —á—Ç–æ? –î–Ω–∏ (d) –∏–ª–∏ —á–∞—Å—ã (h)?",
                bonusConfigLanguage: "json"
            },
            {
                name: "–£—Ä–æ–≤–µ–Ω—å 3: CI/CD –∫–æ–Ω–≤–µ–π–µ—Ä",
                description: "–ö–æ–º–∞–Ω–¥–∞ –≤—ã—Ä–æ—Å–ª–∞ –¥–æ 10 —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç –∫–æ–º–º–∏—Ç–∞ –¥–æ production!",
                requirements: "–ü–æ—Å—Ç—Ä–æ–π—Ç–µ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π pipeline: Git ‚Üí –°–±–æ—Ä–∫–∞ ‚Üí –¢–µ—Å—Ç—ã ‚Üí Docker –æ–±—Ä–∞–∑ ‚Üí –ê–≤—Ç–æ–¥–µ–ø–ª–æ–π",
                availableBlocks: ['Git Repo', 'Build', 'Test', 'Docker Registry', 'Deploy', 'Monitoring', 'Production'],
                requiredBlocks: ['Git Repo', 'Build', 'Test', 'Docker Registry', 'Deploy'],
                requiredConnections: [
                    {from: 'Git Repo', to: 'Build'},
                    {from: 'Build', to: 'Test'},
                    {from: 'Test', to: 'Docker Registry'},
                    {from: 'Docker Registry', to: 'Deploy'}
                ],
                difficulty: 2,
                hint: "üí° GitOps –ø–æ–¥—Ö–æ–¥: –∫–∞–∂–¥—ã–π git push –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–±–æ—Ä–∫—É, –ø—Ä–æ–≥–æ–Ω—è–µ—Ç —Ç–µ—Å—Ç—ã, —Å–æ–±–∏—Ä–∞–µ—Ç Docker –æ–±—Ä–∞–∑ –∏ –¥–µ–ø–ª–æ–∏—Ç –µ—Å–ª–∏ –≤—Å—ë –û–ö",
                bonusConfigBuggy: `stages:
  - build
  - test
  - deploy

build_app:
  stage: build
  script:
    - npm install
    - npm run build

test_app:
  stage: test
  script:
    - npm run test
  only:
    - main

deploy_app:
  stage: deploy
  script:
    - docker build -t myapp:latest .
    - docker push myapp:latest
  only:
    - develop`,
                bonusConfigFixed: `stages:
  - build
  - test
  - deploy

build_app:
  stage: build
  script:
    - npm install
    - npm run build

test_app:
  stage: test
  script:
    - npm run test
  only:
    - main

deploy_app:
  stage: deploy
  script:
    - docker build -t myapp:latest .
    - docker push myapp:latest
  only:
    - main`,
                bonusConfigHint: "üéØ Deploy –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–ª—è –≤–µ—Ç–∫–∏ develop, –∞ —Ç–µ—Å—Ç—ã –¥–ª—è main. –ù—É–∂–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è!",
                bonusConfigLanguage: "yaml"
            },
            {
                name: "–£—Ä–æ–≤–µ–Ω—å 4: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞",
                description: "10000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–Ω–ª–∞–π–Ω! –¢—è–∂–µ–ª—ã–µ –∑–∞–¥–∞—á–∏ –∑–∞–º–µ–¥–ª—è—é—Ç API. –í–Ω–µ–¥—Ä–∏—Ç–µ –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π",
                requirements: "Message Queue —Ä–∞–∑–≥—Ä—É–∑–∏—Ç Backend: –¥–æ–ª–≥–∏–µ –∑–∞–¥–∞—á–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç Worker'—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ",
                availableBlocks: ['Frontend', 'Backend API', 'Database', 'RabbitMQ', 'Worker', 'Notifications', 'Redis', 'Monitoring'],
                requiredBlocks: ['Frontend', 'Backend API', 'Database', 'RabbitMQ', 'Worker', 'Notifications'],
                requiredConnections: [
                    {from: 'Frontend', to: 'Backend API'},
                    {from: 'Backend API', to: 'Database'},
                    {from: 'Backend API', to: 'RabbitMQ'},
                    {from: 'RabbitMQ', to: 'Worker'},
                    {from: 'Worker', to: 'Database'},
                    {from: 'Worker', to: 'Notifications'}
                ],
                difficulty: 2.5,
                hint: "üí° Backend –±—ã—Å—Ç—Ä–æ –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ —Å—Ç–∞–≤–∏—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å. Worker –∑–∞–±–∏—Ä–∞–µ—Ç –∑–∞–¥–∞—á–∏ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–æ–Ω–æ–º",
                bonusConfigBuggy: `const amqp = require('amqplib');

const config = {
  url: 'amqp://localhost',
  queue: 'tasks',
  prefetch: 10,
  durable: true,
  retry: {
    maxRetries: 3,
    delay: 5000
  },
  deadLetter: {
    exchange: 'dlx',
    queue: 'tasks.dlq'
  }
};

async function consumeMessages() {
  const connection = await amqp.connect(config.url);
  const channel = await connection.createChannel();

  await channel.assertQueue(config.queue, {
    durable: config.durable
  });

  channel.prefetch(1);

  channel.consume(config.queue, async (msg) => {
    await processMessage(msg);
    channel.ack(msg);
  });
}`,
                bonusConfigFixed: `const amqp = require('amqplib');

const config = {
  url: 'amqp://localhost',
  queue: 'tasks',
  prefetch: 10,
  durable: true,
  retry: {
    maxRetries: 3,
    delay: 5000
  },
  deadLetter: {
    exchange: 'dlx',
    queue: 'tasks.dlq'
  }
};

async function consumeMessages() {
  const connection = await amqp.connect(config.url);
  const channel = await connection.createChannel();

  await channel.assertQueue(config.queue, {
    durable: config.durable
  });

  channel.prefetch(config.prefetch);

  channel.consume(config.queue, async (msg) => {
    await processMessage(msg);
    channel.ack(msg);
  });
}`,
                bonusConfigHint: "üéØ Prefetch –≤ –∫–æ–Ω—Ñ–∏–≥–µ 10, –∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 1. Worker –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ!",
                bonusConfigLanguage: "javascript"
            },
            {
                name: "–£—Ä–æ–≤–µ–Ω—å 5: Production –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞",
                description: "100K –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π! –ù—É–∂–Ω–∞ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º",
                requirements: "High Availability: Load Balancer, –Ω–µ—Å–∫–æ–ª—å–∫–æ Backend —Å–µ—Ä–≤–µ—Ä–æ–≤, –æ–±—â–∏–π Cache, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ–≥–æ",
                availableBlocks: ['Frontend', 'Load Balancer', 'Backend API', 'Backend API 2', 'Redis', 'Database', 'RabbitMQ', 'Worker', 'Monitoring', 'Logging', 'CDN'],
                requiredBlocks: ['Load Balancer', 'Backend API', 'Backend API 2', 'Redis', 'Database', 'Monitoring'],
                requiredConnections: [
                    {from: 'Load Balancer', to: 'Backend API'},
                    {from: 'Load Balancer', to: 'Backend API 2'},
                    {from: 'Backend API', to: 'Redis'},
                    {from: 'Backend API', to: 'Database'},
                    {from: 'Backend API 2', to: 'Redis'},
                    {from: 'Backend API 2', to: 'Database'},
                    {from: 'Monitoring', to: 'Backend API'},
                    {from: 'Monitoring', to: 'Backend API 2'}
                ],
                difficulty: 3,
                hint: "üí° Load Balancer —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏. –ï—Å–ª–∏ –æ–¥–∏–Ω —É–ø–∞–¥–µ—Ç - –≤—Ç–æ—Ä–æ–π –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É. –í—Å–µ —à–∞—Ä—è—Ç Cache",
                bonusConfigBuggy: `upstream backend {
    least_conn;
    server backend1:3000 max_fails=3 fail_timeout=30s;
    server backend2:3000 max_fails=3 fail_timeout=30s;
}

server {
    listen 80;
    server_name api.example.com;

    location / {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_connect_timeout 5s;
        proxy_send_timeout 60s;
        proxy_read_timeout 10s;
    }

    location /health {
        access_log off;
        return 200 "healthy";
    }
}`,
                bonusConfigFixed: `upstream backend {
    least_conn;
    server backend1:3000 max_fails=3 fail_timeout=30s;
    server backend2:3000 max_fails=3 fail_timeout=30s;
}

server {
    listen 80;
    server_name api.example.com;

    location / {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_connect_timeout 5s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    location /health {
        access_log off;
        return 200 "healthy";
    }
}`,
                bonusConfigHint: "üéØ Read timeout 10s —Å–ª–∏—à–∫–æ–º –º–∞–ª –ø—Ä–∏ send timeout 60s. –î–æ–ª–≥–∏–µ –∑–∞–ø—Ä–æ—Å—ã –æ–±–æ—Ä–≤—É—Ç—Å—è!",
                bonusConfigLanguage: "nginx"
            },
            {
                name: "–£—Ä–æ–≤–µ–Ω—å 6: –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞",
                description: "–ú–æ–Ω–æ–ª–∏—Ç –±–æ–ª—å—à–µ –Ω–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è! –†–∞–∑–±–µ–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã —Å API Gateway",
                requirements: "API Gateway ‚Üí User Service, Product Service, Order Service. –ö–∞–∂–¥—ã–π —Å–æ —Å–≤–æ–µ–π –ë–î!",
                availableBlocks: ['API Gateway', 'User Service', 'Product Service', 'Order Service', 'User DB', 'Product DB', 'Order DB', 'Redis', 'Message Bus'],
                requiredBlocks: ['API Gateway', 'User Service', 'Product Service', 'Order Service', 'User DB', 'Product DB', 'Order DB'],
                requiredConnections: [
                    {from: 'API Gateway', to: 'User Service'},
                    {from: 'API Gateway', to: 'Product Service'},
                    {from: 'API Gateway', to: 'Order Service'},
                    {from: 'User Service', to: 'User DB'},
                    {from: 'Product Service', to: 'Product DB'},
                    {from: 'Order Service', to: 'Order DB'}
                ],
                difficulty: 3.5,
                hint: "üí° –ö–∞–∂–¥—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–µ–∑–∞–≤–∏—Å–∏–º —Å–æ —Å–≤–æ–µ–π –±–∞–∑–æ–π. API Gateway - –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã",
                bonusConfigBuggy: `{
  "routes": [
    {
      "path": "/api/users/*",
      "service": "user-service",
      "url": "http://user-service:3001",
      "timeout": 5000
    },
    {
      "path": "/api/products/*",
      "service": "product-service",
      "url": "http://product-service:3002",
      "timeout": 5000
    },
    {
      "path": "/api/orders/*",
      "service": "product-service",
      "url": "http://order-service:3003",
      "timeout": 5000
    }
  ],
  "rateLimit": {
    "windowMs": 60000,
    "max": 100
  }
}`,
                bonusConfigFixed: `{
  "routes": [
    {
      "path": "/api/users/*",
      "service": "user-service",
      "url": "http://user-service:3001",
      "timeout": 5000
    },
    {
      "path": "/api/products/*",
      "service": "product-service",
      "url": "http://product-service:3002",
      "timeout": 5000
    },
    {
      "path": "/api/orders/*",
      "service": "order-service",
      "url": "http://order-service:3003",
      "timeout": 5000
    }
  ],
  "rateLimit": {
    "windowMs": 60000,
    "max": 100
  }
}`,
                bonusConfigHint: "üéØ –ú–∞—Ä—à—Ä—É—Ç /api/orders/* –≤–µ–¥–µ—Ç –Ω–µ –Ω–∞ —Ç–æ—Ç —Å–µ—Ä–≤–∏—Å! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ service name",
                bonusConfigLanguage: "json"
            },
            {
                name: "–£—Ä–æ–≤–µ–Ω—å 7: Event-Driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞",
                description: "1M —Å–æ–±—ã—Ç–∏–π –≤ —Å–µ–∫—É–Ω–¥—É! –ü–æ—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–∞–∫—Ç–∏–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É –Ω–∞ —Å–æ–±—ã—Ç–∏—è—Ö —Å Kafka",
                requirements: "–°–µ—Ä–≤–∏—Å—ã –æ–±—â–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è: Event Producer ‚Üí Kafka ‚Üí Event Consumers (–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã)",
                availableBlocks: ['Frontend', 'API Gateway', 'Order Service', 'Payment Service', 'Inventory Service', 'Notification Service', 'Kafka', 'Database', 'Analytics', 'Monitoring'],
                requiredBlocks: ['API Gateway', 'Order Service', 'Kafka', 'Payment Service', 'Inventory Service', 'Notification Service'],
                requiredConnections: [
                    {from: 'API Gateway', to: 'Order Service'},
                    {from: 'Order Service', to: 'Kafka'},
                    {from: 'Kafka', to: 'Payment Service'},
                    {from: 'Kafka', to: 'Inventory Service'},
                    {from: 'Kafka', to: 'Notification Service'}
                ],
                difficulty: 4,
                hint: "üí° Order Service –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ Kafka. –í—Å–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–µ–∞–≥–∏—Ä—É—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ",
                bonusConfigBuggy: `const { Kafka } = require('kafkajs');

const kafka = new Kafka({
  clientId: 'order-service',
  brokers: ['kafka:9092']
});

const producer = kafka.producer();
const consumer = kafka.consumer({
  groupId: 'payment-service'
});

async function publishOrderCreated(order) {
  await producer.connect();
  await producer.send({
    topic: 'order-created',
    messages: [
      {
        key: order.id,
        value: JSON.stringify(order),
        partition: 0
      }
    ]
  });
}

async function consumeEvents() {
  await consumer.connect();
  await consumer.subscribe({
    topic: 'order-created',
    fromBeginning: true
  });

  await consumer.run({
    eachMessage: async ({ message }) => {
      const order = JSON.parse(message.value);
      await processPayment(order);
    }
  });
}`,
                bonusConfigFixed: `const { Kafka } = require('kafkajs');

const kafka = new Kafka({
  clientId: 'order-service',
  brokers: ['kafka:9092']
});

const producer = kafka.producer();
const consumer = kafka.consumer({
  groupId: 'payment-service'
});

async function publishOrderCreated(order) {
  await producer.connect();
  await producer.send({
    topic: 'order-created',
    messages: [
      {
        key: order.id,
        value: JSON.stringify(order)
      }
    ]
  });
}

async function consumeEvents() {
  await consumer.connect();
  await consumer.subscribe({
    topic: 'order-created',
    fromBeginning: true
  });

  await consumer.run({
    eachMessage: async ({ message }) => {
      const order = JSON.parse(message.value);
      await processPayment(order);
    }
  });
}`,
                bonusConfigHint: "üéØ –ñ–µ—Å—Ç–∫–æ —É–∫–∞–∑–∞–Ω–∞ partition: 0. Kafka —Å–∞–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç –ø–æ –∫–ª—é—á—É!",
                bonusConfigLanguage: "javascript"
            }
        ];

        let editor;
        let bonusEditor;
        let currentRound = 0;
        let roundsCompleted = 0; // Count of successfully completed rounds
        let startTime;
        let timerInterval;
        let currentTargetCode = '';
        let gameMode = 'typing'; // 'typing', 'bugHunting', –∏–ª–∏ 'architect'

        // New game mechanics
        let activityStartTime = 0;
        let isGameActive = false; // –§–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–≥—Ä—ã –¥–ª—è anti-cheat
        let activityTimerInterval = null;
        let attemptsRemaining = 5; // For Cloud Architect
        let penalties = []; // Penalty history for Cloud Architect

        // Cloud Architect game state
        let droppedBlocks = [];
        let connections = [];
        let selectedBlock = null;
        let connectingMode = false;

        // Config editing state
        let currentBonusLevel = null;

        require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs' } });

        require(['vs/editor/editor.main'], function () {
            editor = monaco.editor.create(document.getElementById('editor'), {
                value: '',
                language: 'javascript',
                theme: 'vs',
                fontSize: 18,
                minimap: { enabled: false },
                scrollBeyondLastLine: false,
                lineNumbers: 'on',
                renderLineHighlight: 'all',
                automaticLayout: true,
                quickSuggestions: false,
                parameterHints: { enabled: false },
                suggestOnTriggerCharacters: false,
                acceptSuggestionOnCommitCharacter: false,
                tabCompletion: 'off',
                wordBasedSuggestions: false
            });

            // DOM-–∑–∞—â–∏—Ç–∞ –æ—Ç –≤—Å—Ç–∞–≤–∫–∏ (–ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –î–û Monaco)
            const editorDomNode = editor.getDomNode();
            editorDomNode.addEventListener('paste', (e) => {
                if (isGameActive) {
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    isGameActive = false;
                    showFinalScreen(false, '–ü–æ–ø—ã—Ç–∫–∞ –≤—Å—Ç–∞–≤–∫–∏ –∫–æ–¥–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–∞', true);
                }
            }, { capture: true, passive: false });

            // Fallback –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ Monaco API
            editor.onDidPaste((e) => {
                if (isGameActive) {
                    isGameActive = false;
                    editor.trigger('keyboard', 'undo');
                    showFinalScreen(false, '–ü–æ–ø—ã—Ç–∫–∞ –≤—Å—Ç–∞–≤–∫–∏ –∫–æ–¥–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–∞', true);
                }
            });

            // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å Command Palette (F1)
            editor.onKeyDown((e) => {
                if (e.keyCode === monaco.KeyCode.F1) {
                    e.preventDefault();
                    e.stopPropagation();
                }
            });

            // –î–µ—Ç–µ–∫—Ü–∏—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤–≤–æ–¥–∞
            editor.onDidChangeModelContent((e) => {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–∞—Å—Å–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (>50 —Å–∏–º–≤–æ–ª–æ–≤ –∑–∞ —Ä–∞–∑)
                e.changes.forEach(change => {
                    if (change.text.length > 50) {
                        console.warn('‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: –º–∞—Å—Å–æ–≤—ã–π –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ (' + change.text.length + ' —Å–∏–º–≤–æ–ª–æ–≤). –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏–≥—Ä–∞–π—Ç–µ —á–µ—Å—Ç–Ω–æ!');
                    }
                });
                checkCode();
            });

            // –°–æ–∑–¥–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
            bonusEditor = monaco.editor.create(document.getElementById('bonusEditor'), {
                value: '',
                language: 'yaml',
                theme: 'vs',
                fontSize: 16,
                minimap: { enabled: false },
                scrollBeyondLastLine: false,
                lineNumbers: 'on',
                renderLineHighlight: 'all',
                automaticLayout: true
            });

            // DOM-–∑–∞—â–∏—Ç–∞ –æ—Ç –≤—Å—Ç–∞–≤–∫–∏ –¥–ª—è bonusEditor (–ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –î–û Monaco)
            const bonusEditorDomNode = bonusEditor.getDomNode();
            bonusEditorDomNode.addEventListener('paste', (e) => {
                if (isGameActive) {
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    isGameActive = false;
                    showFinalScreen(false, '–ü–æ–ø—ã—Ç–∫–∞ –≤—Å—Ç–∞–≤–∫–∏ –∫–æ–¥–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–∞', true);
                }
            }, { capture: true, passive: false });

            // Fallback –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ Monaco API –¥–ª—è bonusEditor
            bonusEditor.onDidPaste((e) => {
                if (isGameActive) {
                    isGameActive = false;
                    bonusEditor.trigger('keyboard', 'undo');
                    showFinalScreen(false, '–ü–æ–ø—ã—Ç–∫–∞ –≤—Å—Ç–∞–≤–∫–∏ –∫–æ–¥–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–∞', true);
                }
            });

            // Initialize drink icon as locked
        });

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–µ—Ç –Ω–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤—Å—Ç–∞–≤–∫—É
        document.addEventListener('copy', (e) => e.preventDefault());
        document.addEventListener('cut', (e) => e.preventDefault());
        document.addEventListener('paste', (e) => e.preventDefault());
        document.addEventListener('contextmenu', (e) => e.preventDefault());

        // Anti-cheat: DevTools detection
        let devToolsOpen = false;
        const threshold = 160; // —Ä–∞–∑–Ω–∏—Ü–∞ –≤ –ø–∏–∫—Å–µ–ª—è—Ö –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ DevTools

        setInterval(() => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–≥—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞
            if (isGameActive && !devToolsOpen) {
                const widthThreshold = window.outerWidth - window.innerWidth > threshold;
                const heightThreshold = window.outerHeight - window.innerHeight > threshold;

                if (widthThreshold || heightThreshold) {
                    devToolsOpen = true;
                    showFinalScreen(false, '–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞', true);
                }
            }

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –µ—Å–ª–∏ –∏–≥—Ä–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞
            if (!isGameActive) {
                devToolsOpen = false;
            }
        }, 500); // –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 500–º—Å

        // Activity timer (countdown) for time-limited modes
        function startActivityTimer(durationMinutes) {
            activityStartTime = Date.now();
            const durationMs = durationMinutes * 60 * 1000;
            const endTime = activityStartTime + durationMs;

            if (activityTimerInterval) clearInterval(activityTimerInterval);

            activityTimerInterval = setInterval(() => {
                const now = Date.now();
                const remaining = Math.max(0, endTime - now);
                const totalSeconds = Math.floor(remaining / 1000);
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;

                document.getElementById('timer').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

                if (remaining <= 0) {
                    clearInterval(activityTimerInterval);
                    showFinalScreen(true); // true = timed out
                }
            }, 100);
        }

        function startTypingGame() {
            gameMode = 'typing';
            isGameActive = true;
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('finishBtn').style.display = 'block';
            document.getElementById('codeLabel').textContent = '–ù–∞–ø–µ—á–∞—Ç–∞–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥:';
            document.getElementById('bugDescription').style.display = 'none';
            currentRound = 0;
            startActivityTimer(10); // 10 minutes for testing
            nextRound();
        }

        function startBugHuntingGame() {
            // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫ –∏–∑ dropdown
            const selectedLanguage = document.getElementById('languageSelector').value;

            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –±–∞–≥–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞
            bugScenarios = bugScenariosByLanguage[selectedLanguage];

            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Monaco Editor –Ω–∞ –Ω—É–∂–Ω—ã–π —è–∑—ã–∫
            const monacoLanguages = {
                'javascript': 'javascript',
                'python': 'python',
                'cpp': 'cpp',
                'csharp': 'csharp',
                'java': 'java',
                'golang': 'go'
            };

            // –û–±–Ω–æ–≤–ª—è–µ–º —è–∑—ã–∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            if (editor) {
                monaco.editor.setModelLanguage(editor.getModel(), monacoLanguages[selectedLanguage]);
            }

            gameMode = 'bugHunting';
            isGameActive = true;
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('finishBtn').style.display = 'block';
            document.getElementById('codeLabel').textContent = '–ë–∞–≥ –≤ —ç—Ç–æ–º –∫–æ–¥–µ:';
            document.getElementById('bugDescription').style.display = 'block';
            currentRound = 0;
            startActivityTimer(10); // 10 minutes for testing
            nextRound();
        }

        function nextRound() {
            // No round limit for typing and bugHunting - play until timer expires
            // Only architect mode has limited levels (7)
            if (gameMode === 'architect' && currentRound >= 7) {
                endGame();
                return;
            }

            currentRound++;
            updateStats();

            if (gameMode === 'typing') {
                // Cycle through code snippets if we exceed the array length
                const snippetIndex = (currentRound - 1) % codeSnippets.length;
                const snippet = codeSnippets[snippetIndex];
                currentTargetCode = snippet.code;
                document.getElementById('targetCode').textContent = currentTargetCode;
                editor.setValue('');
            } else {
                // Cycle through bug scenarios if we exceed the array length
                const scenarioIndex = (currentRound - 1) % bugScenarios.length;
                const scenario = bugScenarios[scenarioIndex];
                currentTargetCode = scenario.fixedCode;
                document.getElementById('targetCode').textContent = scenario.buggyCode;
                document.getElementById('bugDescriptionText').innerHTML =
                    `<strong>${scenario.description}</strong><br><br>` +
                    `üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞: ${scenario.hint}`;
                editor.setValue(scenario.buggyCode);
            }

            editor.focus();

            startTime = Date.now();
            // startTimer(); // –£–±—Ä–∞–Ω–æ: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç –æ—Ç startActivityTimer()

            document.getElementById('feedback').textContent = '';
            document.getElementById('feedback').className = 'feedback';
        }

        // –§—É–Ω–∫—Ü–∏—è startTimer() –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è - –≤–µ—Å—å –æ—Ç—Å—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ startActivityTimer()
        // function startTimer() {
        //     if (timerInterval) clearInterval(timerInterval);
        //     timerInterval = setInterval(() => {
        //         const elapsed = (Date.now() - startTime) / 1000;
        //         document.getElementById('timer').textContent = elapsed.toFixed(1);
        //     }, 100);
        // }

        function checkCode() {
            const userCode = editor.getValue();

            if (gameMode === 'typing') {
                // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∫–æ–¥ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è: —É–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –≤ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–æ–∫ –∏ –≤ –∫–æ–Ω—Ü–µ —Ñ–∞–π–ª–∞
                const normalizeCode = (code) => {
                    return code
                        .split('\n')
                        .map(line => line.trimEnd())
                        .join('\n')
                        .trimEnd();
                };

                const normalizedUserCode = normalizeCode(userCode);
                const normalizedTargetCode = normalizeCode(currentTargetCode);

                const progress = (userCode.length / currentTargetCode.length) * 100;
                document.getElementById('progress').style.width = Math.min(progress, 100) + '%';

                if (normalizedUserCode === normalizedTargetCode) {
                    roundComplete();
                } else if (normalizedTargetCode.startsWith(normalizedUserCode)) {
                    // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–≤–æ–¥
                    document.getElementById('feedback').textContent = '‚úì –û—Ç–ª–∏—á–Ω–æ!';
                    document.getElementById('feedback').className = 'feedback perfect';
                } else {
                    // –û—à–∏–±–∫–∞
                    document.getElementById('feedback').textContent = '‚úó –û—à–∏–±–∫–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥';
                    document.getElementById('feedback').className = 'feedback error';
                    document.querySelector('.editor-container').classList.add('shake');
                    setTimeout(() => {
                        document.querySelector('.editor-container').classList.remove('shake');
                    }, 500);
                }
            } else {
                // Bug hunting mode - remove ALL whitespace for comparison
                const normalizeCode = (code) => {
                    // Remove all whitespace characters for comparison
                    return code.replace(/\s+/g, '');
                };

                const normalizedUserCode = normalizeCode(userCode);
                const normalizedTargetCode = normalizeCode(currentTargetCode);

                // Calculate similarity with original formatting for progress bar
                const similarity = calculateSimilarity(userCode.trim(), currentTargetCode.trim());
                const progress = similarity * 100;
                document.getElementById('progress').style.width = progress + '%';

                if (normalizedUserCode === normalizedTargetCode) {
                    roundComplete();
                } else if (similarity > 0.9) {
                    document.getElementById('feedback').textContent = 'üî• –ü–æ—á—Ç–∏! –ï—â–µ —á—É—Ç—å-—á—É—Ç—å!';
                    document.getElementById('feedback').className = 'feedback good';
                } else if (similarity > 0.7) {
                    document.getElementById('feedback').textContent = 'üí™ –ù–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏!';
                    document.getElementById('feedback').className = 'feedback good';
                } else {
                    document.getElementById('feedback').textContent = 'üîç –ò—â–∏—Ç–µ –±–∞–≥...';
                    document.getElementById('feedback').className = 'feedback';
                }
            }
        }

        function calculateSimilarity(str1, str2) {
            const len1 = str1.length;
            const len2 = str2.length;

            if (len1 === 0 && len2 === 0) return 1;
            if (len1 === 0 || len2 === 0) return 0;

            let matches = 0;
            const maxLen = Math.max(len1, len2);

            for (let i = 0; i < Math.min(len1, len2); i++) {
                if (str1[i] === str2[i]) matches++;
            }

            return matches / maxLen;
        }

        function roundComplete() {
            clearInterval(timerInterval);

            const elapsed = (Date.now() - startTime) / 1000;

            let difficulty, basePoints, roundScore, message;

            if (gameMode === 'typing') {
                const snippet = codeSnippets[currentRound - 1];
                difficulty = snippet.difficulty;
                basePoints = 1000;
                const timeBonus = Math.max(1, 10 / elapsed);
                const roundMultiplier = currentRound;
                roundScore = Math.round(basePoints * timeBonus * difficulty * roundMultiplier);

                if (elapsed < 5) {
                    message = `üî• –û–ì–û–ù–¨!`;
                } else if (elapsed < 10) {
                    message = `‚ö° –ë—ã—Å—Ç—Ä–æ!`;
                } else {
                    message = `üëç –ù–µ–ø–ª–æ—Ö–æ!`;
                }
            } else {
                const scenarioIndex = (currentRound - 1) % bugScenarios.length;
                const scenario = bugScenarios[scenarioIndex];
                difficulty = scenario.difficulty;
                basePoints = 2000; // Bug fixing

                const timeBonus = Math.max(1, 30 / elapsed); // –ë–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–æ–∏—Å–∫ –±–∞–≥–∞
                const roundMultiplier = currentRound;
                roundScore = Math.round(basePoints * timeBonus * difficulty * roundMultiplier);

                if (elapsed < 20) {
                    message = `üèÜ –ú–ê–°–¢–ï–† –î–ï–ë–ê–ì–ê!`;
                } else if (elapsed < 40) {
                    message = `üîç –ë–∞–≥ –Ω–∞–π–¥–µ–Ω!`;
                } else {
                    message = `‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!`;
                }
            }


            // –ê–Ω–∏–º–∞—Ü–∏—è - –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ, —Ç–∞–∫ –∫–∞–∫ —ç–ª–µ–º–µ–Ω—Ç 'score' –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ HTML
            // document.getElementById('score').classList.add('pulse');
            // setTimeout(() => {
            //     document.getElementById('score').classList.remove('pulse');
            // }, 500);

            document.getElementById('feedback').textContent = message;
            document.getElementById('feedback').className = 'feedback perfect';

            roundsCompleted++; // Increment completed rounds counter

            updateStats();

            setTimeout(() => {
                nextRound();
            }, 2000);
        }

        function updateStats() {
            document.getElementById('round').textContent = currentRound;
        }


        function showFinalScreen(timedOut = false, customMessage = null, isCheatDetected = false) {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä—É
            isGameActive = false;
            activityStartTime = 0;
            clearInterval(timerInterval);
            if (activityTimerInterval) clearInterval(activityTimerInterval);

            // Hide game areas
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('architectArea').style.display = 'none';
            document.getElementById('bonusConfigArea').style.display = 'none';

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–∏—Ç–µ—Ä—Å—Ç–≤–∞
            if (isCheatDetected) {
                document.getElementById('finalTitle').textContent = '‚ö†Ô∏è –•–æ—Ä–æ—à–∞—è –ø–æ–ø—ã—Ç–∫–∞, –Ω–æ –Ω–µ –≤ —ç—Ç–æ—Ç —Ä–∞–∑';
                document.getElementById('finalModeMessage').textContent = customMessage || '–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –æ–±–º–∞–Ω–∞';
                document.getElementById('finalRoundsCompleted').textContent = '0';
                document.getElementById('finalTimeSpent').textContent = '0:00';
            } else {
                // Calculate results
                let elapsedTime = activityStartTime > 0 ? Math.floor((Date.now() - activityStartTime) / 1000) : 0;

                // If timed out automatically, cap at 10 minutes (600 seconds)
                if (timedOut && elapsedTime > 600) {
                    elapsedTime = 600;
                }

                const minutes = Math.floor(elapsedTime / 60);
                const seconds = elapsedTime % 60;
                const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;

                // Update final screen data
                document.getElementById('finalRoundsCompleted').textContent = roundsCompleted;
                document.getElementById('finalTimeSpent').textContent = timeString;

                // Set title based on game mode
                if (gameMode === 'typing') {
                    document.getElementById('finalTitle').textContent = '‚ö° –°–∫–æ—Ä–æ—Å—Ç–Ω–æ–π –Ω–∞–±–æ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω!';
                    document.getElementById('finalModeMessage').textContent = '–ü–æ–±–µ–¥–∏—Ç–µ–ª—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ –Ω–∞–∏–±–æ–ª—å—à–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Ä–∞—É–Ω–¥–æ–≤';
                } else if (gameMode === 'bugHunting') {
                    document.getElementById('finalTitle').textContent = 'üêõ –ö–æ–¥-–•–∞–Ω—Ç–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω!';
                    document.getElementById('finalModeMessage').textContent = `–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –í—ã –∏—Å–ø—Ä–∞–≤–∏–ª–∏ ${roundsCompleted} ${roundsCompleted === 1 ? '–±–∞–≥' : roundsCompleted < 5 ? '–±–∞–≥–∞' : '–±–∞–≥–æ–≤'}!`;
                } else if (gameMode === 'architect') {
                    document.getElementById('finalTitle').textContent = 'üèóÔ∏è –¢–ï–ö–ò LOW-–ö–û–î–ò–ù–ì –∑–∞–≤–µ—Ä—à–µ–Ω!';
                    document.getElementById('finalModeMessage').textContent = `–ü—Ä–æ–π–¥–µ–Ω–æ —É—Ä–æ–≤–Ω–µ–π: ${roundsCompleted}/7`;
                }
            }

            // Show final screen
            document.getElementById('finalScreen').classList.add('show');
        }

        function endGame() {
            showFinalScreen();
        }

        function restartGame() {
            document.getElementById('finalScreen').classList.remove('show');
            location.reload();
        }

        function backToMenu() {
            document.getElementById('finalScreen').classList.remove('show');
            document.getElementById('startScreen').style.display = 'flex';
            document.getElementById('finishBtn').style.display = 'none';
            currentRound = 0;
            attemptsRemaining = 5;
            penalties = [];
        }

        function finishGame() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É –¥–æ—Å—Ä–æ—á–Ω–æ?')) {
                showFinalScreen();
                document.getElementById('finishBtn').style.display = 'none';
            }
        }

        // ============ Cloud Architect Game Functions ============

        function startArchitectGame() {
            gameMode = 'architect';
            isGameActive = true;
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('architectArea').style.display = 'block';
            document.getElementById('finishBtn').style.display = 'block';
            currentRound = 0;
            roundsCompleted = 0;
            attemptsRemaining = 5;
            penalties = [];
            updateAttemptsDisplay();
            startActivityTimer(10); // 10 minutes for the whole game
            nextArchitectLevel();
        }

        function updateAttemptsDisplay() {
            const display = document.getElementById('attemptsDisplay');
            display.textContent = `‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∏: ${attemptsRemaining}/5`;

            // Change color based on remaining attempts
            if (attemptsRemaining <= 1) {
                display.style.background = '#f8d7da';
                display.style.borderColor = '#dc3545';
                display.style.color = '#721c24';
            } else if (attemptsRemaining <= 2) {
                display.style.background = '#fff3cd';
                display.style.borderColor = '#ffc107';
                display.style.color = '#856404';
            } else {
                display.style.background = '#d1ecf1';
                display.style.borderColor = '#17a2b8';
                display.style.color = '#0c5460';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–ª–æ–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —É–∂–µ —Ä–∞–∑–º–µ—â–µ–Ω–Ω—ã—Ö
        function updateAvailableBlocks() {
            const level = architectureLevels[currentRound - 1];
            if (!level) return;

            const blocksContainer = document.getElementById('availableBlocks');
            blocksContainer.innerHTML = '';

            // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —É–∂–µ —Ä–∞–∑–º–µ—â—ë–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ –±–ª–æ–∫–æ–≤
            const placedTypes = droppedBlocks.map(b => b.type);

            // –§–∏–ª—å—Ç—Ä—É–µ–º: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏
            const unusedBlocks = level.availableBlocks.filter(
                blockName => !placedTypes.includes(blockName)
            );

            // –†–µ–Ω–¥–µ—Ä–∏–º —Ç–æ–ª—å–∫–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏
            unusedBlocks.forEach(blockName => {
                const blockEl = document.createElement('div');
                blockEl.className = 'service-block';
                blockEl.textContent = blockName;
                blockEl.draggable = true;
                blockEl.dataset.blockType = blockName;

                blockEl.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('blockType', blockName);
                    blockEl.classList.add('dragging');
                });

                blockEl.addEventListener('dragend', () => {
                    blockEl.classList.remove('dragging');
                });

                blocksContainer.appendChild(blockEl);
            });
        }

        function nextArchitectLevel() {
            if (currentRound >= 7) {
                endGame();
                return;
            }

            currentRound++;
            updateStats();

            const level = architectureLevels[currentRound - 1];

            document.getElementById('architectTask').innerHTML = `<strong>${level.name}</strong><br>${level.description}`;
            document.getElementById('architectRequirements').innerHTML = `<strong>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:</strong> ${level.requirements}`;

            // –û—á–∏—Å—Ç–∫–∞ canvas
            droppedBlocks = [];
            connections = [];
            selectedBlock = null;
            connectingMode = false;
            document.getElementById('droppedBlocks').innerHTML = '';
            redrawConnections();

            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–ª–æ–∫–æ–≤
            updateAvailableBlocks();

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ canvas –¥–ª—è –ø—Ä–∏–µ–º–∞ –±–ª–æ–∫–æ–≤
            const canvas = document.getElementById('canvas');
            canvas.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            canvas.addEventListener('drop', (e) => {
                e.preventDefault();
                const blockType = e.dataTransfer.getData('blockType');
                if (!blockType) return;

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–≥–æ –±–ª–æ–∫–∞ –Ω–∞ canvas
                const alreadyExists = droppedBlocks.some(b => b.type === blockType);
                if (alreadyExists) {
                    document.getElementById('architectFeedback').textContent = `–ë–ª–æ–∫ "${blockType}" —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ canvas`;
                    document.getElementById('architectFeedback').className = 'feedback error';
                    setTimeout(() => {
                        document.getElementById('architectFeedback').textContent = '';
                    }, 2000);
                    return;
                }

                const canvasRect = canvas.getBoundingClientRect();
                const x = e.clientX - canvasRect.left - 60;
                const y = e.clientY - canvasRect.top - 20;

                addBlockToCanvas(blockType, x, y);
            });

            startTime = Date.now();
            // startTimer(); // –£–±—Ä–∞–Ω–æ: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç –æ—Ç startActivityTimer()

            document.getElementById('architectFeedback').textContent = '';
            document.getElementById('architectFeedback').className = 'feedback';
        }

        function addBlockToCanvas(blockType, x, y) {
            const blockId = 'block_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

            const blockEl = document.createElement('div');
            blockEl.className = 'dropped-block';
            blockEl.textContent = blockType;
            blockEl.style.left = x + 'px';
            blockEl.style.top = y + 'px';
            blockEl.dataset.blockId = blockId;
            blockEl.dataset.blockType = blockType;

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –±–ª–æ–∫–∞
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-block-btn';
            deleteBtn.innerHTML = '√ó';
            deleteBtn.title = '–£–¥–∞–ª–∏—Ç—å –±–ª–æ–∫';

            deleteBtn.addEventListener('mousedown', (e) => {
                e.preventDefault();
                e.stopPropagation();
            });

            deleteBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                deleteBlock(blockId);
            });

            blockEl.appendChild(deleteBtn);

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ connection handles
            ['right', 'left', 'top', 'bottom'].forEach(position => {
                const handle = document.createElement('div');
                handle.className = `connection-handle handle-${position}`;
                handle.dataset.position = position;

                handle.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    startConnectionFromHandle(blockId, blockType, e);
                });

                // –û—Ç–∫–ª—é—á–∞–µ–º draggable –¥–ª—è —Ä—É—á–µ–∫
                handle.setAttribute('draggable', 'false');

                blockEl.appendChild(handle);
            });

            // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –±–ª–æ–∫–æ–≤ –≤–Ω—É—Ç—Ä–∏ canvas
            (function setupDragging() {
                let isDragging = false;
                let dragOffsetX = 0;
                let dragOffsetY = 0;
                let animationFrameId = null;

                const updateBlockPosition = (clientX, clientY) => {
                    const block = droppedBlocks.find(b => b.id === blockId);
                    if (!block) return;

                    const canvasRect = document.getElementById('canvas').getBoundingClientRect();
                    const newX = clientX - canvasRect.left - dragOffsetX;
                    const newY = clientY - canvasRect.top - dragOffsetY;

                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö canvas
                    const maxX = canvasRect.width - blockEl.offsetWidth;
                    const maxY = canvasRect.height - blockEl.offsetHeight;

                    block.x = Math.max(0, Math.min(newX, maxX));
                    block.y = Math.max(0, Math.min(newY, maxY));

                    blockEl.style.left = block.x + 'px';
                    blockEl.style.top = block.y + 'px';

                    // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                    redrawConnections();
                };

                const handleMouseDown = (e) => {
                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ –Ω–∞ —Ä—É—á–∫–∏ –∏ –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
                    if (e.target.classList.contains('connection-handle') ||
                        e.target.classList.contains('delete-block-btn')) {
                        return;
                    }

                    isDragging = true;
                    const rect = blockEl.getBoundingClientRect();
                    dragOffsetX = e.clientX - rect.left;
                    dragOffsetY = e.clientY - rect.top;

                    blockEl.style.cursor = 'grabbing';
                    blockEl.style.zIndex = '1000';
                    e.preventDefault();
                    e.stopPropagation();
                };

                const handleMouseMove = (e) => {
                    if (!isDragging) return;

                    e.preventDefault();

                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º requestAnimationFrame –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
                    if (animationFrameId) {
                        cancelAnimationFrame(animationFrameId);
                    }

                    animationFrameId = requestAnimationFrame(() => {
                        updateBlockPosition(e.clientX, e.clientY);
                    });
                };

                const stopDragging = () => {
                    if (isDragging) {
                        isDragging = false;
                        blockEl.style.cursor = 'move';
                        blockEl.style.zIndex = '';

                        if (animationFrameId) {
                            cancelAnimationFrame(animationFrameId);
                            animationFrameId = null;
                        }

                        // –§–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
                        redrawConnections();
                    }
                };

                const handleMouseUp = (e) => {
                    stopDragging();
                };

                const handleMouseLeave = (e) => {
                    // –ï—Å–ª–∏ –∫—É—Ä—Å–æ—Ä –≤—ã—à–µ–ª –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
                    if (isDragging && e.target === document.body) {
                        stopDragging();
                    }
                };

                blockEl.addEventListener('mousedown', handleMouseDown);
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
                document.addEventListener('mouseleave', handleMouseLeave);

                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç "–∑–∞–ª–∏–ø–∞–Ω–∏—è"
                window.addEventListener('blur', stopDragging);
            })();

            document.getElementById('droppedBlocks').appendChild(blockEl);

            droppedBlocks.push({
                id: blockId,
                type: blockType,
                x: x,
                y: y,
                element: blockEl
            });

            validateRealTime();
            updateAvailableBlocks();
        }

        function startConnectionFromHandle(blockId, blockType, event) {
            event.preventDefault();
            event.stopPropagation();

            selectedBlock = {id: blockId, type: blockType};
            connectingMode = true;

            const blockEl = document.querySelector(`[data-block-id="${blockId}"]`);
            blockEl.classList.add('connecting');

            document.getElementById('architectFeedback').textContent = `–í—ã–±–µ—Ä–∏—Ç–µ –±–ª–æ–∫ –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å "${blockType}"`;
            document.getElementById('architectFeedback').className = 'feedback';

            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ª–∏–Ω–∏—é –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
            const svg = document.getElementById('connectionsSvg');
            const tempLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            tempLine.setAttribute('class', 'connection-line temp-connection');
            tempLine.setAttribute('stroke', '#ff9900');
            tempLine.setAttribute('stroke-width', '3');
            tempLine.setAttribute('stroke-dasharray', '5, 5');
            tempLine.id = 'tempConnectionLine';

            // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
            const fromBlock = droppedBlocks.find(b => b.id === blockId);
            const canvasRect = document.getElementById('canvas').getBoundingClientRect();
            const fromRect = fromBlock.element.getBoundingClientRect();
            const startX = fromRect.left - canvasRect.left + fromRect.width / 2;
            const startY = fromRect.top - canvasRect.top + fromRect.height / 2;

            tempLine.setAttribute('x1', startX);
            tempLine.setAttribute('y1', startY);
            tempLine.setAttribute('x2', startX);
            tempLine.setAttribute('y2', startY);

            svg.appendChild(tempLine);

            // –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –Ω–∞ document –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            const handleMouseMove = (e) => {
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ª–∏–Ω–∏–∏
                const currentX = e.clientX - canvasRect.left;
                const currentY = e.clientY - canvasRect.top;
                tempLine.setAttribute('x2', currentX);
                tempLine.setAttribute('y2', currentY);
            };

            const handleMouseUp = (e) => {
                // –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ª–∏–Ω–∏—é
                const tempLineEl = document.getElementById('tempConnectionLine');
                if (tempLineEl) {
                    tempLineEl.remove();
                }

                const target = e.target.closest('.dropped-block');
                if (target && target.dataset.blockId !== blockId) {
                    const targetId = target.dataset.blockId;
                    const targetType = target.dataset.blockType;

                    const existingConnection = connections.find(
                        c => c.from === blockId && c.to === targetId
                    );

                    if (!existingConnection) {
                        connections.push({
                            from: blockId,
                            fromType: blockType,
                            to: targetId,
                            toType: targetType
                        });
                        redrawConnections();
                        validateRealTime();

                        document.getElementById('architectFeedback').textContent = `‚úì –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ: ${blockType} ‚Üí ${targetType}`;
                        document.getElementById('architectFeedback').className = 'feedback perfect';
                    }
                }

                // –°–±—Ä–æ—Å —Ä–µ–∂–∏–º–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                selectedBlock = null;
                connectingMode = false;
                document.querySelectorAll('.dropped-block').forEach(el => {
                    el.classList.remove('selected', 'connecting');
                });

                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('mouseup', handleMouseUp);
            };

            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
        }

        function handleBlockClick(blockId, blockType) {
            if (!connectingMode) {
                // –ù–∞—á–∞–ª–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                selectedBlock = {id: blockId, type: blockType};
                connectingMode = true;

                // –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è
                document.querySelectorAll('.dropped-block').forEach(el => {
                    el.classList.remove('selected', 'connecting');
                });
                const blockEl = document.querySelector(`[data-block-id="${blockId}"]`);
                blockEl.classList.add('connecting');

                document.getElementById('architectFeedback').textContent = `–í—ã–±–µ—Ä–∏—Ç–µ –±–ª–æ–∫ –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å "${blockType}"`;
                document.getElementById('architectFeedback').className = 'feedback';
            } else {
                // –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                if (selectedBlock.id !== blockId) {
                    const existingConnection = connections.find(
                        c => c.from === selectedBlock.id && c.to === blockId
                    );

                    if (!existingConnection) {
                        connections.push({
                            from: selectedBlock.id,
                            fromType: selectedBlock.type,
                            to: blockId,
                            toType: blockType
                        });
                        redrawConnections();
                        validateRealTime();
                    }
                }

                // –°–±—Ä–æ—Å —Ä–µ–∂–∏–º–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                selectedBlock = null;
                connectingMode = false;
                document.querySelectorAll('.dropped-block').forEach(el => {
                    el.classList.remove('selected', 'connecting');
                });
                document.getElementById('architectFeedback').textContent = '';
            }
        }

        function redrawConnections() {
            const svg = document.getElementById('connectionsSvg');
            svg.innerHTML = `
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#ff0032" />
                    </marker>
                    <marker id="arrowhead-valid" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#00cc66" />
                    </marker>
                </defs>
            `;

            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
            document.querySelectorAll('.delete-connection-btn').forEach(btn => btn.remove());

            connections.forEach((conn, index) => {
                const fromBlock = droppedBlocks.find(b => b.id === conn.from);
                const toBlock = droppedBlocks.find(b => b.id === conn.to);

                if (fromBlock && toBlock) {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –±–ª–æ–∫–∞ + –ø–æ–ª–æ–≤–∏–Ω—É –µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
                    const fromEl = fromBlock.element;
                    const toEl = toBlock.element;

                    const x1 = fromBlock.x + fromEl.offsetWidth / 2;
                    const y1 = fromBlock.y + fromEl.offsetHeight / 2;
                    const x2 = toBlock.x + toEl.offsetWidth / 2;
                    const y2 = toBlock.y + toEl.offsetHeight / 2;

                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', x1);
                    line.setAttribute('y1', y1);
                    line.setAttribute('x2', x2);
                    line.setAttribute('y2', y2);
                    line.setAttribute('class', 'connection-line');
                    line.dataset.connectionIndex = index;

                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                    const level = architectureLevels[currentRound - 1];
                    const isValid = level.requiredConnections.some(
                        rc => rc.from === conn.fromType && rc.to === conn.toType
                    );

                    if (isValid) {
                        line.classList.add('valid');
                        line.setAttribute('marker-end', 'url(#arrowhead-valid)');
                    } else {
                        line.classList.add('invalid');
                        line.setAttribute('marker-end', 'url(#arrowhead)');
                    }

                    // –ö–ª–∏–∫ –Ω–∞ –ª–∏–Ω–∏—é –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
                    line.addEventListener('click', (e) => {
                        e.stopPropagation();
                        deleteConnection(index);
                    });

                    svg.appendChild(line);

                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω–µ –ª–∏–Ω–∏–∏
                    const midX = (x1 + x2) / 2;
                    const midY = (y1 + y2) / 2;

                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-connection-btn';
                    deleteBtn.innerHTML = '√ó';
                    deleteBtn.style.left = midX + 'px';
                    deleteBtn.style.top = midY + 'px';
                    deleteBtn.title = '–£–¥–∞–ª–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ';

                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        deleteConnection(index);
                    });

                    document.getElementById('canvas').appendChild(deleteBtn);
                }
            });
        }

        function deleteConnection(index) {
            connections.splice(index, 1);
            redrawConnections();
            validateRealTime();

            document.getElementById('architectFeedback').textContent = '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ';
            document.getElementById('architectFeedback').className = 'feedback';
            setTimeout(() => {
                if (document.getElementById('architectFeedback').textContent === '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ') {
                    document.getElementById('architectFeedback').textContent = '';
                }
            }, 1500);
        }

        function deleteBlock(blockId) {
            // –ù–∞—Ö–æ–¥–∏–º –±–ª–æ–∫
            const blockIndex = droppedBlocks.findIndex(b => b.id === blockId);
            if (blockIndex === -1) return;

            const block = droppedBlocks[blockIndex];

            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–∏–º –±–ª–æ–∫–æ–º
            connections = connections.filter(conn => conn.from !== blockId && conn.to !== blockId);

            // –£–¥–∞–ª—è–µ–º –±–ª–æ–∫ –∏–∑ DOM
            block.element.remove();

            // –£–¥–∞–ª—è–µ–º –±–ª–æ–∫ –∏–∑ –º–∞—Å—Å–∏–≤–∞
            droppedBlocks.splice(blockIndex, 1);

            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            redrawConnections();
            validateRealTime();
            updateAvailableBlocks();

            document.getElementById('architectFeedback').textContent = `–ë–ª–æ–∫ "${block.type}" —É–¥–∞–ª–µ–Ω`;
            document.getElementById('architectFeedback').className = 'feedback';
            setTimeout(() => {
                if (document.getElementById('architectFeedback').textContent === `–ë–ª–æ–∫ "${block.type}" —É–¥–∞–ª–µ–Ω`) {
                    document.getElementById('architectFeedback').textContent = '';
                }
            }, 1500);
        }

        function validateRealTime() {
            const level = architectureLevels[currentRound - 1];
            const placedBlockTypes = droppedBlocks.map(b => b.type);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç—Ä–µ–±—É–µ–º—ã—Ö –±–ª–æ–∫–æ–≤
            const missingBlocks = level.requiredBlocks.filter(rb => !placedBlockTypes.includes(rb));

            if (missingBlocks.length > 0) {
                document.getElementById('architectFeedback').textContent =
                    `–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å: ${missingBlocks.join(', ')}`;
                document.getElementById('architectFeedback').className = 'feedback';
            } else if (connections.length < level.requiredConnections.length) {
                document.getElementById('architectFeedback').textContent =
                    `–ù—É–∂–Ω–æ –±–æ–ª—å—à–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (${connections.length}/${level.requiredConnections.length})`;
                document.getElementById('architectFeedback').className = 'feedback good';
            } else {
                document.getElementById('architectFeedback').textContent =
                    `–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É! –í—Å–µ –±–ª–æ–∫–∏ –Ω–∞ –º–µ—Å—Ç–µ.`;
                document.getElementById('architectFeedback').className = 'feedback perfect';
            }
        }

        function checkArchitecture() {
            const level = architectureLevels[currentRound - 1];
            const placedBlockTypes = droppedBlocks.map(b => b.type);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤—Å–µ—Ö —Ç—Ä–µ–±—É–µ–º—ã—Ö –±–ª–æ–∫–æ–≤
            const hasAllBlocks = level.requiredBlocks.every(rb => placedBlockTypes.includes(rb));

            if (!hasAllBlocks) {
                handleArchitectureError('‚ùå –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –±–ª–æ–∫–æ–≤!');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
            let correctConnections = 0;
            level.requiredConnections.forEach(rc => {
                const hasConnection = connections.some(
                    c => c.fromType === rc.from && c.toType === rc.to
                );
                if (hasConnection) correctConnections++;
            });

            if (correctConnections === level.requiredConnections.length) {
                // –£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–π–¥–µ–Ω!
                architectLevelComplete();
            } else {
                handleArchitectureError(
                    `‚ùå –ù–µ –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ! (${correctConnections}/${level.requiredConnections.length})`
                );
            }
        }

        function handleArchitectureError(errorMessage) {
            attemptsRemaining--;
            const errorNumber = 5 - attemptsRemaining; // 1st error, 2nd error, etc.

            penalties.push({
                error: errorNumber,
                level: currentRound,
                timestamp: Date.now()
            });

            updateAttemptsDisplay();

            let penaltyMessage = '';

            if (attemptsRemaining === 0) {
                // 5th error - Game Over
                document.getElementById('architectFeedback').textContent =
                    'üíÄ GAME OVER! –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –æ—à–∏–±–æ–∫!';
                document.getElementById('architectFeedback').className = 'feedback error';
                setTimeout(() => {
                    showFinalScreen();
                }, 2000);
                return;
            } else if (errorNumber === 1 || errorNumber === 3) {
                // 1st or 3rd error - Warning
                penaltyMessage = `‚ö†Ô∏è –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï! –°–ª–µ–¥—É—é—â–∞—è –æ—à–∏–±–∫–∞ = –ø—å–µ—Ç–µ! (–ü–æ–ø—ã—Ç–æ–∫: ${attemptsRemaining})`;
            } else if (errorNumber === 2 || errorNumber === 4) {
                // 2nd or 4th error - Drink penalty
                penaltyMessage = `üç∫ –ü–¨–ï–¢–ï! –û—à–∏–±–∫–∞ #${errorNumber}! (–ü–æ–ø—ã—Ç–æ–∫: ${attemptsRemaining})`;
            }

            document.getElementById('architectFeedback').innerHTML =
                `${errorMessage}<br><strong style="color: #dc3545;">${penaltyMessage}</strong>`;
            document.getElementById('architectFeedback').className = 'feedback error';

            document.getElementById('canvas').classList.add('shake');
            setTimeout(() => {
                document.getElementById('canvas').classList.remove('shake');
            }, 500);
        }

        function architectLevelComplete() {
            clearInterval(timerInterval);

            const elapsed = (Date.now() - startTime) / 1000;
            const level = architectureLevels[currentRound - 1];

            let message = '';
            if (elapsed < 30) {
                message = `üèÜ –ê–†–•–ò–¢–ï–ö–¢–û–† –ì–û–î–ê!`;
            } else if (elapsed < 60) {
                message = `‚ö° –ë–´–°–¢–†–û!`;
            } else {
                message = `‚úÖ –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ì–û–¢–û–í–ê!`;
            }

            document.getElementById('architectFeedback').textContent = message;
            document.getElementById('architectFeedback').className = 'feedback perfect';

            // –ê–Ω–∏–º–∞—Ü–∏—è - –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ, —Ç–∞–∫ –∫–∞–∫ —ç–ª–µ–º–µ–Ω—Ç 'score' –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ HTML
            // document.getElementById('score').classList.add('pulse');
            // setTimeout(() => {
            //     document.getElementById('score').classList.remove('pulse');
            // }, 500);

            updateStats();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞—É–Ω–¥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
            setTimeout(() => {
                showBonusStage();
            }, 2500);
        }

        function clearCanvas() {
            droppedBlocks = [];
            connections = [];
            selectedBlock = null;
            connectingMode = false;
            document.getElementById('droppedBlocks').innerHTML = '';
            redrawConnections();
            document.getElementById('architectFeedback').textContent = '';
        }

        function showHint() {
            const level = architectureLevels[currentRound - 1];
            document.getElementById('architectFeedback').textContent = `üí° ${level.hint}`;
            document.getElementById('architectFeedback').className = 'feedback good';
        }

        // ============ Config Editing Functions ============

        function showBonusStage() {
            const level = architectureLevels[currentRound - 1];
            currentBonusLevel = level;

            // –°–∫—Ä—ã–≤–∞–µ–º architect area
            document.getElementById('architectArea').style.display = 'none';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º config area
            document.getElementById('bonusConfigArea').style.display = 'block';

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
            document.getElementById('bonusHint').textContent = level.bonusConfigHint;

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —è–∑—ã–∫ –∏ –∫–æ–¥ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
            const model = bonusEditor.getModel();
            monaco.editor.setModelLanguage(model, level.bonusConfigLanguage);
            bonusEditor.setValue(level.bonusConfigBuggy);

            // –û—á–∏—â–∞–µ–º —Ñ–∏–¥–±–µ–∫
            document.getElementById('bonusFeedback').textContent = '';
            document.getElementById('bonusFeedback').className = 'feedback';
        }

        function checkBonusConfig() {
            const userConfig = bonusEditor.getValue();
            const correctConfig = currentBonusLevel.bonusConfigFixed;

            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã –∏ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
            const normalize = (str) => str.trim().replace(/\s+/g, ' ');

            if (normalize(userConfig) === normalize(correctConfig)) {
                // –ü—Ä–∞–≤–∏–ª—å–Ω–æ!
                document.getElementById('bonusFeedback').textContent =
                    `üéâ –û–¢–õ–ò–ß–ù–û! –ö–æ–Ω—Ñ–∏–≥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω!`;
                document.getElementById('bonusFeedback').className = 'feedback perfect';

                updateStats();

                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–≤–Ω—é
                setTimeout(() => {
                    proceedToNextLevel();
                }, 3000);
            } else {
                // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –Ω–∞—á–∏—Å–ª—è–µ–º —à—Ç—Ä–∞—Ñ
                handleArchitectureError('‚ùå –ö–æ–Ω—Ñ–∏–≥ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ.');

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ bonusFeedback
                const feedbackEl = document.getElementById('bonusFeedback');
                const architectFeedback = document.getElementById('architectFeedback').innerHTML;
                feedbackEl.innerHTML = architectFeedback;
                feedbackEl.className = 'feedback error';

                document.querySelector('.controls').classList.add('shake');
                setTimeout(() => {
                    document.querySelector('.controls').classList.remove('shake');
                }, 500);
            }
        }

        function skipBonus() {
            document.getElementById('bonusFeedback').textContent =
                '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–ø—É—â–µ–Ω–∞. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–≤–Ω—é...';
            document.getElementById('bonusFeedback').className = 'feedback';

            setTimeout(() => {
                proceedToNextLevel();
            }, 1500);
        }

        function proceedToNextLevel() {
            // –°–∫—Ä—ã–≤–∞–µ–º config area
            document.getElementById('bonusConfigArea').style.display = 'none';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º architect area
            document.getElementById('architectArea').style.display = 'block';

            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–≤–Ω—é
            nextArchitectLevel();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ endGame –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ architect —Ä–µ–∂–∏–º–∞ (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫)
        // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è endGame, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç showFinalScreen()
        // const originalEndGame = endGame;
        // endGame = function() {
        //     clearInterval(timerInterval);
        //     document.getElementById('gameArea').style.display = 'none';
        //     document.getElementById('architectArea').style.display = 'none';
        //     // –ë–ê–ì: —ç–ª–µ–º–µ–Ω—Ç–∞ 'gameOver' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 'finalScreen'
        //     // document.getElementById('gameOver').classList.add('show');
        //     // –ë–ê–ì: —ç–ª–µ–º–µ–Ω—Ç–æ–≤ 'finalScore' –∏ 'finalMessage' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ finalScreen
        //     // document.getElementById('finalScore').textContent = totalScore.toLocaleString();
        //     // document.getElementById('finalMessage').textContent = message;
        // };
    </script>
</body>
</html>
